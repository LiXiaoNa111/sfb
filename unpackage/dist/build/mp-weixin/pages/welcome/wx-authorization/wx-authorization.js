(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/welcome/wx-authorization/wx-authorization"],{"166e":function(t,n,e){"use strict";e.r(n);var o=e("fece"),i=e.n(o);for(var a in o)"default"!==a&&function(t){e.d(n,t,(function(){return o[t]}))}(a);n["default"]=i.a},"62ce":function(t,n,e){},aff6:function(t,n,e){"use strict";e.d(n,"b",(function(){return i})),e.d(n,"c",(function(){return a})),e.d(n,"a",(function(){return o}));var o={tuiModal:function(){return e.e("ui/tui-modal/tui-modal").then(e.bind(null,"cbe5"))}},i=function(){var t=this,n=t.$createElement;t._self._c},a=[]},cca8:function(t,n,e){"use strict";e.r(n);var o=e("aff6"),i=e("166e");for(var a in i)"default"!==a&&function(t){e.d(n,t,(function(){return i[t]}))}(a);e("de27");var s,c=e("f0c5"),u=Object(c["a"])(i["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],s);n["default"]=u.exports},de27:function(t,n,e){"use strict";var o=e("62ce"),i=e.n(o);i.a},fdee:function(t,n,e){"use strict";(function(t){e("77c6");o(e("66fd"));var n=o(e("cca8"));function o(t){return t&&t.__esModule?t:{default:t}}t(n.default)}).call(this,e("543d")["createPage"])},fece:function(t,n,e){"use strict";(function(t){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var e={onLoad:function(t){this.type=t.type,console.log("跳转到微信登录页面"),console.log(this.type)},onUnload:function(){this.islogin=t.getStorageSync(this.ISLOGIN),this.islogin||1!=this.type?this.islogin||2!=this.type||t.$emit(this.INFORMBACKLOGINWXME,""):t.$emit(this.INFORMBACKLOGINWX,"")},data:function(){return{islogin:"",type:"",code:"",signature:"",rawData:"",encryptedData:"",iv:"",modal2:!1,button3:[{text:"确定",type:"red"}]}},methods:{getWXSessionkey:function(){var n=this;console.log("点击了去授权"),t.login({provider:"weixin",success:function(e){console.log("获取到微信code"),console.log(e.code),n.$u.get(n.miniWXKeyUrl,{code:e.code}).then((function(t){0==t.status&&n.login(t.data)})).catch((function(e){t.setStorageSync(n.SESSIONKEY,e.data.msg),1==e.data.status&&n.mGetUserInfo(e.data.msg)}))},fail:function(t){console.log("授权失败"),console.log(t)}})},mGetUserInfo:function(n){var e=this,o=this;console.log("sessionKey"+n),t.getUserInfo({provider:"weixin",success:function(t){console.log("用户同意授权"),console.log(t),o.signature=t.signature,o.rawData=t.rawData,o.encryptedData=t.encryptedData,o.iv=t.iv,o.$u.get(o.miniWXInfoUrl,{sessionKey:n,signature:o.signature,rawData:o.rawData,encryptedData:o.encryptedData,iv:o.iv}).then((function(t){0==t.status&&(console.log("接口成"),console.log(t),o.login(t.data))})).catch((function(t){console.log("无账号 新用户 去注册"),console.log(t),o.ddd(t.data)}))},fail:function(t){console.log("用户拒绝授权",t),e.show2()}})},ddd:function(n){100==n.status?t.navigateTo({url:"../wx-authorization-phone/wx-authorization-phone?type="+this.type+"&data="+encodeURIComponent(JSON.stringify(n.data))+"&signature="+encodeURIComponent(JSON.stringify(this.signature))+"&rawData="+encodeURIComponent(JSON.stringify(this.rawData))}):1==n.status&&this.$u.toast(n.msg)},show2:function(){this.modal2=!0},hide2:function(){this.modal2=!1},handleClick2:function(n){n.index;this.hide2(),t.navigateBack()},login:function(n){this.$u.toast("授权登录成功"),t.setStorageSync(this.ISLOGIN,!0),t.setStorageSync(this.TOKEN,n.token),t.setStorageSync(this.ID,n.id),t.$emit(this.LOGINSOCKET,""),t.setStorageSync(this.IPHONE,n.phone),t.setStorageSync(this.CLINICNAME,n.clinicName),t.setStorageSync(this.HEADIMG,n.avatar),t.setStorageSync(this.NAME,n.userName),t.setStorageSync(this.READ,!0),1==n.state&&t.setStorageSync(this.ISID,!0),t.$emit(this.INFORMLOGIN,"更新登录状态"),20==this.type?t.reLaunch({url:"../../clinic-doctor/clinic-doctor"}):t.switchTab({url:"../../diagnosis/diagnosis"})}}};n.default=e}).call(this,e("543d")["default"])}},[["fdee","common/runtime","common/vendor"]]]);