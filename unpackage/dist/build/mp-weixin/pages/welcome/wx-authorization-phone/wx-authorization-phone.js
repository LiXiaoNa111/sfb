(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/welcome/wx-authorization-phone/wx-authorization-phone"],{"0bdd":function(t,e,n){"use strict";(function(t){n("77c6");o(n("66fd"));var e=o(n("3c9f"));function o(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,n("543d")["createPage"])},"3c9f":function(t,e,n){"use strict";n.r(e);var o=n("607f"),a=n("cf16");for(var i in a)"default"!==i&&function(t){n.d(e,t,(function(){return a[t]}))}(i);n("c273");var s,c=n("f0c5"),u=Object(c["a"])(a["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],s);e["default"]=u.exports},"42dd":function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n={onLoad:function(t){this.type=t.type,console.log("到绑定手机号页面的type为："+this.type),this.wxData=JSON.parse(decodeURIComponent(t.data)),this.signature=JSON.parse(decodeURIComponent(t.signature)),this.rawData=JSON.parse(decodeURIComponent(t.rawData))},data:function(){return{type:"",wxData:{},signature:"",rawData:"",phone:"",modal2:!1,button3:[{text:"确定",type:"red"}]}},methods:{show2:function(){this.modal2=!0},hide2:function(){this.modal2=!1},handleClick2:function(e){e.index;this.hide2(),t.navigateBack()},toService:function(){t.navigateTo({url:"../../web-view/agreement-web-view?type=1"})},toPrivacy:function(){t.navigateTo({url:"../../web-view/agreement-web-view?type=2"})},getPhoneNumber:function(e){console.log("点击手机号授权");var n=this;wx.checkSession({success:function(t){console.log("有效啊"),console.log(e.detail),"getPhoneNumber:fail user deny"==e.detail.errMsg?(console.log("拒绝手机号授权"),n.show2()):(console.log("同意手机号授权"),n.getPhone(e.detail))},fail:function(){console.log("session_key 已经失效，需要重新执行登录流程"),this.$u.toast("已经失效，需要重新执行登录流程"),setTimeout((function(){t.navigateBack()}),500)}})},getPhone:function(e){var n=this,o=t.getStorageSync(this.SESSIONKEY);this.$u.get(this.miniWXPhoneUrl,{sessionKey:o,signature:n.signature,rawData:n.rawData,encryptedData:e.encryptedData,iv:e.iv}).then((function(t){console.log("获取手机号"),console.log(t.data.phoneNumber),0==t.status&&(n.phone=t.data.phoneNumber,n.bandPhone())}))},bandPhone:function(){var t=this;this.$u.get(this.customerWXPhoneUrl,{openId:this.wxData.openId,nickName:this.wxData.nickName,gender:this.wxData.gender,avatarUrl:this.wxData.avatarUrl,unionId:this.wxData.unionId,phone:this.phone}).then((function(e){console.log(e),0==e.status&&t.login(e.data)})).catch((function(e){t.$u.toast(e.msg)}))},login:function(e){this.$u.toast("授权登录成功"),t.setStorageSync(this.ISLOGIN,!0),t.setStorageSync(this.TOKEN,e.token),t.setStorageSync(this.ID,e.id),t.$emit(this.LOGINSOCKET,""),t.setStorageSync(this.IPHONE,e.phone),t.setStorageSync(this.CLINICNAME,e.clinicName),t.setStorageSync(this.HEADIMG,e.avatar),t.setStorageSync(this.NAME,e.userName),t.setStorageSync(this.READ,!0),1==e.state&&t.setStorageSync(this.ISID,!0),t.$emit(this.INFORMLOGIN,"更新登录状态"),20==this.type?t.reLaunch({url:"../../clinic-doctor/clinic-doctor"}):t.switchTab({url:"../../diagnosis/diagnosis"})}}};e.default=n}).call(this,n("543d")["default"])},"607f":function(t,e,n){"use strict";n.d(e,"b",(function(){return a})),n.d(e,"c",(function(){return i})),n.d(e,"a",(function(){return o}));var o={tuiModal:function(){return n.e("ui/tui-modal/tui-modal").then(n.bind(null,"cbe5"))}},a=function(){var t=this,e=t.$createElement;t._self._c},i=[]},b929:function(t,e,n){},c273:function(t,e,n){"use strict";var o=n("b929"),a=n.n(o);a.a},cf16:function(t,e,n){"use strict";n.r(e);var o=n("42dd"),a=n.n(o);for(var i in o)"default"!==i&&function(t){n.d(e,t,(function(){return o[t]}))}(i);e["default"]=a.a}},[["0bdd","common/runtime","common/vendor"]]]);