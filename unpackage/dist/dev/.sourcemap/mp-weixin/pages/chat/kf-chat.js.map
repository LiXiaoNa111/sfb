{"version":3,"sources":["uni-app:///main.js","webpack:///F:/uniapp/sfb/sysf_customer_before/pages/chat/kf-chat.vue?fda8","webpack:///F:/uniapp/sfb/sysf_customer_before/pages/chat/kf-chat.vue?020d","webpack:///F:/uniapp/sfb/sysf_customer_before/pages/chat/kf-chat.vue?bd12","webpack:///F:/uniapp/sfb/sysf_customer_before/pages/chat/kf-chat.vue?5a1f","uni-app:///pages/chat/kf-chat.vue","webpack:///F:/uniapp/sfb/sysf_customer_before/pages/chat/kf-chat.vue?0e00","webpack:///F:/uniapp/sfb/sysf_customer_before/pages/chat/kf-chat.vue?a720"],"names":["createPage","Page"],"mappings":";;;;;;;;;;kDAAA;AACA;AACA,+F;AACAA,UAAU,CAACC,eAAD,CAAV,C;;;;;;;;;;;;;ACHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAoH;AACpH;AAC2D;AACL;AACc;;;AAGpE;AACqK;AACrK,gBAAgB,+KAAU;AAC1B,EAAE,6EAAM;AACR,EAAE,kFAAM;AACR,EAAE,2FAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,sFAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;AC7BA;AAAA;AAAA;AAAA;AAAimB,CAAgB,2nBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC4JrnB,+G;AACA;AACA,MADA,kBACA;AACA;AACA,kBADA,EACA;AACA,wBAFA,EAEA;AACA,iBAHA,EAGA;AACA,YAJA,EAIA;AACA,aALA,EAKA;AACA,cANA,EAMA;AACA,gBAPA,EAOA;AACA,kBARA,EAQA;AACA,oBATA,EASA;AACA,qBAVA;AAWA;AACA,iBAZA;AAaA;AACA,6BAdA;AAeA,2BAfA;AAgBA,kBAhBA;AAiBA,sBAjBA;AAkBA,iBAlBA;AAmBA,oBAnBA;AAoBA,cApBA;;AAsBA;;AAEA;AACA,wCAzBA;;AA2BA,oBA3BA;AA4BA,uBA5BA;AA6BA,4BA7BA;AA8BA,sBA9BA;AA+BA,qBA/BA;AAgCA;AACA,qBADA;AAEA,YAFA,EAhCA;;AAoCA,uBApCA;AAqCA,qBArCA;;AAuCA;AACA,0CAxCA;AAyCA,qBAzCA;AA0CA,sBA1CA;AA2CA;AACA,yBA5CA;AA6CA;AACA,oBA9CA;AA+CA,kBA/CA;;AAiDA,GAnDA;AAoDA,QApDA,kBAoDA,MApDA,EAoDA;AACA;AACA;AACA,uCAHA,CAGA;AACA,qEAJA,CAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iCADA;;;AAIA,kBAjBA,GAiBA,iCAjBA;AAkBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAFA;AAGA,iBANA;AAOA;;AAEA;AACA;AACA;AACA,eAFA;;AAIA;AACA;AACA;AACA;AACA;AACA;AACA,eAJA,MAIA;AACA;AACA;;;;;;;;;;;;AAYA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAVA;AAWA;AACA;AACA;AACA;AACA;AACA,eAJA;;;AAOA,gBAjFA,GAiFA,KAjFA;AAkFA;AACA;AACA;AACA;AACA;AACA,yEAFA,CAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAFA;AAGA,mBANA;AAOA;AACA;AACA;AACA;AACA;AACA,eApBA;;AAsBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eATA,EAxGA;AAkHA,GAtKA;AAuKA,QAvKA,oBAuKA;AACA;AACA,GAzKA;AA0KA,QA1KA,oBA0KA;AACA;AACA,GA5KA;AA6KA,UA7KA,sBA6KA;AACA;AACA,GA/KA;AAgLA;AACA;AACA,kBAFA,4BAEA;AACA;AACA,qBADA;AAEA,+BAFA;AAGA,iCAHA;AAIA,UAJA,CAIA;AACA;AACA;AACA,uCAFA,CAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,aAFA;AAGA,WANA;AAOA;AACA,OA7BA,EA6BA,KA7BA,CA6BA;AACA;AACA;AACA;AACA;AACA,OAlCA;AAmCA,KAtCA;AAuCA,WAvCA,mBAuCA,GAvCA,EAuCA;AACA;AACA,oEADA;;AAGA,KA3CA;AA4CA,YA5CA,sBA4CA;AACA;AACA;AACA;AACA,uBADA;AAEA,gBAFA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA,SATA;;AAWA,KA1DA;AA2DA,aA3DA,qBA2DA,SA3DA,EA2DA;AACA;AACA;AACA;AACA,uCADA;AAEA,2BAFA;AAGA,oBAHA;AAIA;AACA,4CADA;AAEA,8CAFA,EAJA;;AAQA;AACA,mBADA;AAEA,6BAFA,EARA;;AAYA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAHA,MAGA;AACA;AACA;AACA,SAxBA;;AA0BA,KAxFA;AAyFA;AACA,eA1FA,uBA0FA,CA1FA,EA0FA;AACA;AACA;AACA;AACA;AACA,mCALA,CAKA;AACA,mCANA,CAMA;AACA,0CAPA,CAOA;AACA;AACA,qBADA;AAEA,+BAFA;AAGA,iCAHA;AAIA,UAJA,CAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6CADA,CACA;AACA;AACA;AACA;AACA;AACA;AACA,wCADA,CACA;AACA,WAFA;AAGA,SATA;AAUA,OA7BA,EA6BA,KA7BA,CA6BA;AACA;AACA;AACA;AACA;AACA,OAlCA;AAmCA,KArIA;AAsIA;AACA,YAvIA,sBAuIA;AACA;AACA;AACA;AACA;AACA,OAHA,MAGA;AACA;AACA;AACA,KA/IA;AAgJA;AACA,cAjJA,wBAiJA;AACA;AACA,KAnJA;AAoJA;AACA,cArJA,wBAqJA;AACA;AACA;AACA;AACA,OAFA,EAEA,GAFA;AAGA,KA1JA;AA2JA;AACA,YA5JA,sBA4JA;AACA;AACA;AACA;AACA,gBADA,EACA;AACA,gCAFA;AAGA;AACA;AACA;AACA;AACA,SAPA;;AASA,KAxKA;AAyKA;AACA,WA1KA,mBA0KA,IA1KA,EA0KA;AACA;AACA;AACA;AACA,uCADA;AAEA,sBAFA;AAGA,oBAHA;AAIA;AACA,4CADA;AAEA,8CAFA,EAJA;;AAQA;AACA,mBADA;AAEA,6BAFA,EARA;;AAYA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAHA,MAGA;AACA;AACA;AACA,SAxBA;;AA0BA,KAvMA;AAwMA;AACA,iBAzMA,2BAyMA;AACA;AACA;AACA;AACA;AACA,KA9MA;AA+MA;AACA,YAhNA,sBAgNA;AACA;AACA;AACA;AACA;AACA,wBALA,CAKA;AACA,KAtNA;AAuNA;AACA,WAxNA,mBAwNA,OAxNA,EAwNA;AACA;AACA;AACA;AACA;AACA,wBADA;AAEA,eAFA;AAGA,2BAHA;AAIA,UAJA,CAIA;AACA;AACA;AACA;AACA,OARA,EAQA,KARA,CAQA;AACA;AACA,OAVA;AAWA,KAvOA;AAwOA;AACA,cAzOA,wBAyOA;AACA;AACA;AACA,qBADA;AAEA,oBAFA;AAGA,qBAHA;AAIA,UAJA,CAIA;AACA;AACA;AACA;AACA;AACA,uEALA,CAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAFA;AAGA,SANA;AAOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OA5BA;AA6BA,KAxQA;AAyQA;AACA,WA1QA,mBA0QA,GA1QA,EA0QA;AACA;AACA,yBADA;AAEA,oBAFA;AAGA,6BAHA;;AAKA,KAhRA;AAiRA;AACA,aAlRA,qBAkRA,GAlRA,EAkRA,EAlRA,EAkRA;AACA;AACA;AACA;AACA;AACA,OAFA;AAGA,KAxRA;AAyRA;AACA,cA1RA,sBA0RA,CA1RA,EA0RA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6CARA,CAQA;AACA,KAnSA;AAoSA;AACA,eArSA,uBAqSA,CArSA,EAqSA;AACA;AACA;AACA;AACA;AACA;AACA,OAFA,EAEA,IAFA;AAGA,KA5SA;AA6SA;AACA,eA9SA,yBA8SA;AACA;AACA;AACA;AACA,2BAJA,CAIA;AACA,2BALA,CAKA;AACA,KApTA;AAqTA;AACA,YAtTA,oBAsTA,CAtTA,EAsTA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAHA,MAGA;AACA;AACA;AACA;AACA,KAnUA;AAoUA;AACA,YArUA,oBAqUA,CArUA,EAqUA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BAPA,CAOA;AACA,KA7UA;AA8UA;AACA,aA/UA,qBA+UA,CA/UA,EA+UA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yCADA;AAEA,wBAFA;AAGA,kCAHA;AAIA,sBAJA;AAKA;AACA,8CADA;AAEA,gDAFA,EALA;;AASA;AACA,qBADA;AAEA,+BAFA,EATA;;AAaA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAHA,MAGA;AACA;AACA;AACA,WAzBA;;AA2BA,OArCA,MAqCA;AACA;AACA;AACA;AACA,KA3XA;AA4XA;AACA,eA7XA,yBA6XA;AACA;AACA;AACA,KAhYA;AAiYA,WAjYA,qBAiYA;AACA;AACA,KAnYA,EAhLA,E;;;;;;;;;;;;;AC7JA;AAAA;AAAA;AAAA;AAAmmC,CAAgB,6kCAAG,EAAC,C;;;;;;;;;;;ACAvnC;AACA,OAAO,KAAU,EAAE,kBAKd","file":"pages/chat/kf-chat.js","sourcesContent":["import 'uni-pages';\nimport Vue from 'vue'\nimport Page from './pages/chat/kf-chat.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./kf-chat.vue?vue&type=template&id=24cd9768&\"\nvar renderjs\nimport script from \"./kf-chat.vue?vue&type=script&lang=js&\"\nexport * from \"./kf-chat.vue?vue&type=script&lang=js&\"\nimport style0 from \"./kf-chat.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\runtime\\\\componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/chat/kf-chat.vue\"\nexport default component.exports","export * from \"-!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\templateLoader.js??vue-loader-options!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--16-0!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\template.js!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-uni-app-loader\\\\page-meta.js!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./kf-chat.vue?vue&type=template&id=24cd9768&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var l0 = _vm.__map(_vm.messageList, function(row, index) {\n    var $orig = _vm.__get_orig(row)\n\n    var g0 =\n      row.creator == 0 && row.type == 1\n        ? row.message.replace(/\\n/g, \"<br>\")\n        : null\n    return {\n      $orig: $orig,\n      g0: g0\n    }\n  })\n\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        l0: l0\n      }\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./kf-chat.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./kf-chat.vue?vue&type=script&lang=js&\"","<template>\r\n\t<view>\r\n\t\t<view class=\"content\" @touchstart=\"hideDrawer\">\r\n\t\t\t<scroll-view class=\"msg-list\" scroll-y=\"true\" :scroll-with-animation=\"scrollAnimation\" :scroll-top=\"scrollTop\"\r\n\t\t\t :scroll-into-view=\"scrollToView\" @scrolltoupper=\"loadHistory\" upper-threshold=\"50\">\r\n\t\t\t\t<!-- 加载历史数据waitingUI -->\r\n\t\t\t\t<view class=\"loading\" v-if=\"isHistoryLoading\">\r\n\t\t\t\t\t<view class=\"spinner\">\r\n\t\t\t\t\t\t<view class=\"rect1\"></view>\r\n\t\t\t\t\t\t<view class=\"rect2\"></view>\r\n\t\t\t\t\t\t<view class=\"rect3\"></view>\r\n\t\t\t\t\t\t<view class=\"rect4\"></view>\r\n\t\t\t\t\t\t<view class=\"rect5\"></view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t\t<!--  \"type\": 1,//1文字 2图片 3语音 4视频 5订单 -->\r\n\t\t\t\t<!-- \"creator\": 1,//0客服 1患者/医生 -->\r\n\t\t\t\t<view class=\"row\" v-for=\"(row,index) in messageList\" :key=\"index\" :id=\"'msg'+row.id\">\r\n\t\t\t\t\t<!-- 自己发出的消息 -->\r\n\t\t\t\t\t<view class=\"my\" v-if=\"row.creator==1\">\r\n\t\t\t\t\t\t<!-- 左-消息 -->\r\n\t\t\t\t\t\t<view class=\"left\">\r\n\t\t\t\t\t\t\t<!-- 文字消息 -->\r\n\t\t\t\t\t\t\t<view v-if=\"row.type==1\" class=\"bubble\">\r\n\t\t\t\t\t\t\t\t<rich-text :nodes=\"row.message\"></rich-text>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t<!-- 图片消息 -->\r\n\t\t\t\t\t\t\t<view v-if=\"row.type==2\" class=\"bubble img\" @tap=\"showPic(row.message)\">\r\n\t\t\t\t\t\t\t\t<!--阿里云图片压缩 缩放图 -->\r\n\t\t\t\t\t\t\t\t<image lazy-load mode=\"aspectFill\" :src=\"row.message+'?x-oss-process=image/resize,l_150'\"></image>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t<!-- 语音消息 -->\r\n\t\t\t\t\t\t\t<view v-if=\"row.type==3\" class=\"bubble voice\" @tap=\"playVoice(row.message,row.id)\" :class=\"playMsgid == row.id?'play':''\">\r\n\t\t\t\t\t\t\t\t<view class=\"length\">{{row.second}}''</view>\r\n\t\t\t\t\t\t\t\t<view class=\"icon my-voice\"></view>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t<!-- 视频消息  class=\"tui-video\" -->\r\n\t\t\t\t\t\t\t<view v-if=\"row.type==4\" class=\"bubble video\">\r\n\t\t\t\t\t\t\t\t<view style=\"position: relative;\" @tap=\"toVideo(row.message)\">\r\n\t\t\t\t\t\t\t\t\t<!-- 视频截图 第一帧 -->\r\n\t\t\t\t\t\t\t\t\t<image style=\"border-radius: 12rpx;width: 250rpx; height: 300rpx;\" :src=\"row.message+'?x-oss-process=video/snapshot,t_1000,m_fast'\"\r\n\t\t\t\t\t\t\t\t\t mode=\"aspectFill\"></image>\r\n\t\t\t\t\t\t\t\t\t<view style=\"width: 100%; height: 100%; position: absolute;top:0%; left: 0%;display: flex;flex-direction: column;align-items: center;justify-content: center;\"\r\n\t\t\t\t\t\t\t\t\t @tap=\"toVideo(row.message)\">\r\n\t\t\t\t\t\t\t\t\t\t<image style=\" width: 50rpx; height:50rpx;\" src=\"../../static/image/icon_play.png\" mode=\"aspectFill\"></image>\r\n\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t<!-- 订单 -->\r\n\t\t\t\t\t\t\t<view v-if=\"row.type==5\" class=\"bubble\">订单</view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<!-- 右-头像 -->\r\n\t\t\t\t\t\t<view class=\"right\">\r\n\t\t\t\t\t\t\t<image style=\"border-radius: 100rpx;\" mode=\"aspectFill\" :src=\"imageUrl==null ?'../../static/image/icon_tx_nor.png':imageUrl\"></image>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<!-- 别人发出的消息 -->\r\n\t\t\t\t\t<view class=\"other\" v-if=\"row.creator==0\">\r\n\t\t\t\t\t\t<view class=\"right\">\r\n\t\t\t\t\t\t\t<view class=\"right-time\">{{row.createTime}}</view>\r\n\t\t\t\t\t\t\t<view class=\"other\">\r\n\t\t\t\t\t\t\t\t<!-- 左-头像 -->\r\n\t\t\t\t\t\t\t\t<view class=\"left\">\r\n\t\t\t\t\t\t\t\t\t<image style=\"border-radius: 100rpx;\" :src=\"img\"></image>\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t<!-- 右-用户名称-时间-消息 -->\r\n\r\n\t\t\t\t\t\t\t\t<!-- 文字消息 -->\r\n\t\t\t\t\t\t\t\t<view v-if=\"row.type==1\" class=\"bubble\">\r\n\t\t\t\t\t\t\t\t\t<rich-text :nodes=\"row.message.replace(/\\n/g,'<br>')\"></rich-text>\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t<!-- 图片消息 -->\r\n\t\t\t\t\t\t\t\t<view v-if=\"row.type==2\" class=\"bubble img\" @tap=\"showPic(row.message)\">\r\n\t\t\t\t\t\t\t\t\t<image lazy-load mode=\"aspectFill\" :src=\"row.message+'?x-oss-process=image/resize,l_150'\"></image>\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t<!-- 语音消息 -->\r\n\t\t\t\t\t\t\t\t<view v-if=\"row.type==3\" class=\"bubble voice\" @tap=\"playVoice(row.message,row.id)\" :class=\"playMsgid == row.id?'play':''\">\r\n\t\t\t\t\t\t\t\t\t<view class=\"icon other-voice\"></view>\r\n\t\t\t\t\t\t\t\t\t<view class=\"length\">{{row.second}}''</view>\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t<!-- 视频消息  class=\"tui-video\" -->\r\n\t\t\t\t\t\t\t\t<view v-if=\"row.type==4\" class=\"bubble video\">\r\n\t\t\t\t\t\t\t\t\t<view style=\"position: relative;\" @tap=\"toVideo(row.message)\">\r\n\t\t\t\t\t\t\t\t\t\t<!-- 视频截图 第一帧 -->\r\n\t\t\t\t\t\t\t\t\t\t<image style=\"border-radius: 12rpx;width: 250rpx; height: 300rpx;\" :src=\"row.message+'?x-oss-process=video/snapshot,t_1000,m_fast'\"\r\n\t\t\t\t\t\t\t\t\t\t mode=\"aspectFill\"></image>\r\n\t\t\t\t\t\t\t\t\t\t<view style=\"width: 100%; height: 100%; position: absolute;top:0%; left: 0%;display: flex;flex-direction: column;align-items: center;justify-content: center;\"\r\n\t\t\t\t\t\t\t\t\t\t @tap=\"toVideo(row.message)\">\r\n\t\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</scroll-view>\r\n\t\t</view>\r\n\r\n\t\t<!-- 抽屉栏 -->\r\n\t\t<view class=\"popup-layer\" :class=\"popupLayerClass\" @touchmove.stop.prevent=\"discard\">\r\n\t\t\t<!-- 更多功能 相册-拍照 -->\r\n\t\t\t<view class=\"more-layer\" :class=\"{hidden:hideMore}\">\r\n\t\t\t\t<view class=\"list\">\r\n\t\t\t\t\t<view @tap=\"getImage\" class=\"bottm-tu-txt\">\r\n\t\t\t\t\t\t<view class=\"box\">\r\n\t\t\t\t\t\t\t<image style=\"width: 50rpx; height: 40rpx;\" src=\"../../static/image/icon_tp1.png\" mode=\"aspectFill\"></image>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<view class=\"more-txt\">图片</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view @tap=\"getVideo\" class=\"bottm-tu-txt\">\r\n\t\t\t\t\t\t<view class=\"box\">\r\n\t\t\t\t\t\t\t<image style=\"width: 50rpx; height: 40rpx;\" src=\"../../static/image/icon_sp.png\" mode=\"aspectFill\"></image>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<view class=\"more-txt\">视频</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\r\n\t\t<!-- 底部输入栏 -->\r\n\t\t<view class=\"input-box\" :class=\"popupLayerClass\" @touchmove.stop.prevent=\"discard\">\r\n\t\t\t<!-- H5下不能录音，输入栏布局改动一下 -->\r\n\t\t\t<!-- #ifndef H5 -->\r\n\t\t\t<view class=\"voice\">\r\n\t\t\t\t<view class=\"icon\" :class=\"isVoice?'jianpan':'yuyin'\" @tap=\"switchVoice\"></view>\r\n\t\t\t</view>\r\n\t\t\t<!-- #endif -->\r\n\r\n\t\t\t<view class=\"textbox\">\r\n\t\t\t\t<view class=\"voice-mode\" :class=\"[isVoice?'':'hidden',recording?'recording':'']\" @touchstart=\"voiceBegin\"\r\n\t\t\t\t @touchmove.stop.prevent=\"voiceIng\" @touchend=\"voiceEnd\" @touchcancel=\"voiceCancel\">{{voiceTis}}</view>\r\n\t\t\t\t<view class=\"text-mode\" :class=\"isVoice?'hidden':''\">\r\n\t\t\t\t\t<view class=\"box\">\r\n\t\t\t\t\t\t<!-- cursor-spacing=\"20\" 设置弹出框跟输入框之间的距离 -->\r\n\t\t\t\t\t\t<textarea cursor-spacing=\"20\" :focus=\"focus\" auto-height=\"true\" v-model=\"textMsg\" @focus=\"textareaFocus\" />\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t<!-- #ifndef H5 -->\r\n\t\t<view class=\"more\" @tap=\"showMore\">\r\n\t\t\t\t<view class=\"icon add\"></view>\r\n\t\t\t</view>\r\n\t\t<!-- #endif -->\r\n\t\t<view class=\"send\" :class=\"isVoice?'hidden':''\" @touchend.prevent=\"sendText\">\r\n\t\t\t\t<view class=\"btn\">发送</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t<!-- 录音UI效果 -->\r\n\t\t<view class=\"record\" :class=\"recording?'':'hidden'\">\r\n\t\t\t\t<view class=\"ing\" :class=\"willStop?'hidden':''\"><view class=\"icon luyin2\" ></view></view>\r\n\t\t\t\t<view class=\"cancel\" :class=\"willStop?'':'hidden'\"><view class=\"icon chehui\" ></view></view>\r\n\t\t\t\t<view class=\"tis\" :class=\"willStop?'change':''\">{{recordTis}}</view>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n<script>\r\n\timport permision from \"@/js_sdk/wa-permission/permission.js\"\r\n\texport default {\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tplatform: '', //平台\r\n\t\t\t\tisJurisdiction: '', //录音权限\r\n\t\t\t\taccount: '', //对方账号\r\n\t\t\t\tid: '', //聊天室id\r\n\t\t\t\timg: '', //对方头像\r\n\t\t\t\tname: '', //对方用户名称\r\n\t\t\t\tpageNum: 1, //页数\r\n\t\t\t\tpageSize: 15, //每页条数\r\n\t\t\t\timageUrl: null, //自己头像\r\n\t\t\t\tmessageList: [],\r\n\t\t\t\t//文字消息\r\n\t\t\t\ttextMsg: '',\r\n\t\t\t\t//消息列表\r\n\t\t\t\tisHistoryLoading: false,\r\n\t\t\t\tscrollAnimation: true,\r\n\t\t\t\tscrollTop: 0,\r\n\t\t\t\tscrollToView: '',\r\n\t\t\t\tmsgList: [],\r\n\t\t\t\tmsgImgList: [],\r\n\t\t\t\tmyuid: 0,\r\n\r\n\t\t\t\t//录音相关参数\r\n\t\t\t\t// #ifndef H5\r\n\t\t\t\t//H5不能录音\r\n\t\t\t\tRECORDER: uni.getRecorderManager(),\r\n\t\t\t\t// #endif\r\n\t\t\t\tisVoice: false,\r\n\t\t\t\tvoiceTis: '按住 说话',\r\n\t\t\t\trecordTis: \"手指上滑 取消发送\",\r\n\t\t\t\trecording: false,\r\n\t\t\t\twillStop: false,\r\n\t\t\t\tinitPoint: {\r\n\t\t\t\t\tidentifier: 0,\r\n\t\t\t\t\tY: 0\r\n\t\t\t\t},\r\n\t\t\t\trecordTimer: null,\r\n\t\t\t\trecordLength: 0,\r\n\r\n\t\t\t\t//播放语音相关参数\r\n\t\t\t\tAUDIO: uni.createInnerAudioContext(),\r\n\t\t\t\tplayMsgid: null,\r\n\t\t\t\tVoiceTimer: null,\r\n\t\t\t\t// 抽屉参数\r\n\t\t\t\tpopupLayerClass: '',\r\n\t\t\t\t// more参数\r\n\t\t\t\thideMore: true,\r\n\t\t\t\tfocus: false,\r\n\t\t\t};\r\n\t\t},\r\n\t\tasync onLoad(option) {\r\n\t\t\tthis.id=uni.getStorageSync(this.KFCHATID);\r\n\t\t\tthis.getMessageData();\r\n\t\t\tthis.name = option.name; //对方姓名\r\n\t\t\tthis.img=JSON.parse(decodeURIComponent(option.img));//对方头像\r\n\t\t\t//自己头像\r\n\t\t\tconsole.log(\"自己头像\"+uni.getStorageSync(this.HEADIMG));\r\n\t\t\t// if (uni.getStorageSync(this.HEADIMG).length == 0) {\r\n\t\t\t// \tthis.imageUrl = null\r\n\t\t\t// } else {\r\n\t\t\t\tthis.imageUrl = uni.getStorageSync(this.HEADIMG);\r\n\t\t\t// }\r\n\t\t\tconsole.log(\"接收：\" + this.name + this.img);\r\n\t\t\tuni.setNavigationBarTitle({\r\n\t\t\t\ttitle: this.name\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tlet mess=uni.getStorageSync(this.id+\"\");\r\n\t\t\tif(!this.$u.test.isEmpty(mess)){\r\n\t\t\t\tthis.messageList=mess;\r\n\t\t\t\tconsole.log(\"获取到缓存的数据2\");\r\n\t\t\t\tconsole.log(this.messageList);\r\n\t\t\t\t// 滚动到底部\r\n\t\t\t\tthis.$nextTick(function() {\r\n\t\t\t\t\t//进入页面滚动到底部\r\n\t\t\t\t\tthis.scrollTop = 9999;\r\n\t\t\t\t\tthis.$nextTick(function() {\r\n\t\t\t\t\t\tthis.scrollAnimation = true;\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\t//语音自然播放结束\r\n\t\t\tthis.AUDIO.onEnded((res)=>{\r\n\t\t\t\tthis.playMsgid=null;\r\n\t\t\t});\r\n\r\n\t\t\t//初始获取录音权限状态\r\n\t\t\tthis.platform = uni.getSystemInfoSync().platform\r\n\t\t\t if (this.platform == 'ios') {\r\n\t\t\t\tconsole.log('我是iOS')\r\n\t\t\t\t//有权限返回true，否则返回false\r\n\t\t\t\tthis.isJurisdiction=permision.judgeIosPermission(\"record\");\r\n\t\t\t} else if (this.platform == 'android') {\r\n\t\t\t\tconsole.log('我是安卓')\r\n\t\t\t\t/* 获取当前手机是否有录音权限 */\r\n\t\t\t\t// #ifdef APP-PLUS\r\n\t\t\t\tvar androidJurisdiction=await permision.requestAndroidPermission('android.permission.RECORD_AUDIO');\r\n\t\t\t\t//1\t已获取授权 0\t未获取授权 -1被永久拒绝授权\r\n\t\t\t\tif( androidJurisdiction==0){\r\n\t\t\t\t\tthis.isJurisdiction=false;\r\n\t\t\t\t}else if(androidJurisdiction==1){\r\n\t\t\t\t\tthis.isJurisdiction=true;\r\n\t\t\t\t}else if(androidJurisdiction==-1){\r\n\t\t\t\t\tthis.isJurisdiction=false;\r\n\t\t\t\t}\r\n\t\t\t\t// #endif\r\n\t\t\t\t/* 获取当前手机是否有录音权限 */\r\n\t\t\t}\r\n\r\n\t\t\t// #ifndef H5\r\n\t\t\t//录音开始事件\r\n\t\t\tthis.RECORDER.onStart((e)=>{\r\n\t\t\t\t//没有权限情况 申请权限弹框 \r\n\t\t\t\t// Android会在允许权限之后重新赋值isJurisdiction为true 所以直接跳过了当前的if\r\n\t\t\t\t//ios则需要重新新获取权限的状态\r\n\t\t\t\tif (!this.isJurisdiction && this.platform == 'ios') {\r\n\t\t\t\t\tthis.isJurisdiction=permision.judgeIosPermission(\"record\");\r\n\t\t\t\t}\r\n\t\t\t\tif(this.isJurisdiction){\r\n\t\t\t\t\tthis.recordBegin(e);\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t//录音结束事件\r\n\t\t\tthis.RECORDER.onStop((e)=>{\r\n\t\t\t\tif(this.isJurisdiction){\r\n\t\t\t\t\tthis.recordEnd(e);\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t// #endif\r\n\t\t\t\r\n\t\t\tvar me=this;\r\n\t\t\tuni.$on(this.SOCKETKFCHAT,data=>{\r\n\t\t\t    console.log('kf患者收到服务器通知：' + data);\r\n\t\t\t\t var oneMessageData= JSON.parse(data);\r\n\t\t\t  \tif(oneMessageData[0].creator==0){\r\n\t\t\t  \t\tconsole.log('当前集合：' + me.messageList);\r\n\t\t\t  \t\tme.messageList=me.messageList.concat(oneMessageData);//数据拼接\r\n\t\t\t  \t\tconsole.log(\"滚动到最下面的id\");\r\n\t\t\t  \t\tconsole.log(oneMessageData[0].id);\r\n\t\t\t  \t\tme.$nextTick(function() {\r\n\t\t\t  \t\t\t//进入页面滚动到底部\r\n\t\t\t  \t\t\tme.scrollToView = 'msg'+oneMessageData[0].id;\r\n\t\t\t  \t\t\tme.$nextTick(function() {\r\n\t\t\t  \t\t\t\tme.scrollAnimation = true;\r\n\t\t\t  \t\t\t});\r\n\t\t\t  \t\t});\r\n\t\t\t  \t\t// 获取消息中的图片,并处理显示尺寸\r\n\t\t\t  \t\tif(oneMessageData[0].type==2 ){\r\n\t\t\t  \t\t\tme.msgImgList.push(oneMessageData[0].content);\r\n\t\t\t  \t\t} \r\n\t\t\t  \t}\r\n\t\t\t});\r\n\r\n\t\t\tuni.onKeyboardHeightChange(res => {\r\n\t\t\t\tconsole.log(\"软键盘高度监听\"+res.height);\r\n\t\t\t\t//监听软键盘的高度 \r\n\t\t\t\t//当点击软键盘自带的收起按钮的时候也就是会隐藏软键盘 这时候监听到的软键盘的高度就是0 、\r\n\t\t\t\t//让输入框取消焦点 这时候再去输入内容的时候 输入框就会弹起\r\n\t\t\t\tif(res.height==0){\r\n\t\t\t\t\tthis.focus=false;\r\n\t\t\t\t\tthis.hideDrawer();\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t},\r\n\t\tonShow(){\r\n\t\t\tthis.scrollTop = 9999999;\r\n\t\t},\r\n\t\tonHide() {\r\n\t\t\tthis.hideDrawer();\r\n\t\t},\r\n\t\tonUnload() {\r\n\t\t\tuni.$off(this.SOCKETKFCHAT);\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\t//获取聊天信息列表 加载初始页面消息\r\n\t\t\tgetMessageData() {\r\n\t\t\t\tthis.$u.get(this.ChattingChatRecordUrl, {\r\n\t\t\t\t\t'id': this.id,\r\n\t\t\t\t\t'pageNum': this.pageNum,\r\n\t\t\t\t\t'pageSize': this.pageSize\r\n\t\t\t\t}).then(res => {\r\n\t\t\t\t\tif(!this.$u.test.isEmpty(res.data.list)){\r\n\t\t\t\t\t\tvar newData = res.data.list.reverse();\r\n\t\t\t\t\t\tthis.messageList = newData; //数组翻转\r\n\t\t\t\t\t\tconsole.log(\"去22缓存的数据\");\r\n\t\t\t\t\t\tconsole.log(this.id+this.messageList);\r\n\t\t\t\t\t\tuni.setStorageSync(this.id+\"\",this.messageList);\r\n\t\t\t\t\t\tconsole.log(\"去缓存的数据\");\r\n\t\t\t\t\t\tconsole.log(this.messageList);\r\n\t\t\t\t\t\t// 获取消息中的图片,并处理显示尺寸\r\n\t\t\t\t\t\tfor(let i=0;i<newData.length;i++){\r\n\t\t\t\t\t\t\tif(newData[i].type==2 ){\r\n\t\t\t\t\t\t\t\tthis.msgImgList.push(newData[i].message);\r\n\t\t\t\t\t\t\t} \r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// 滚动到底部\r\n\t\t\t\t\t\tthis.$nextTick(function() {\r\n\t\t\t\t\t\t\t//进入页面滚动到底部\r\n\t\t\t\t\t\t\tthis.scrollTop = 9999;\r\n\t\t\t\t\t\t\tthis.$nextTick(function() {\r\n\t\t\t\t\t\t\t\tthis.scrollAnimation = true;\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}).catch(ex => {\r\n\t\t\t\t\tif (ex.data.status == 1) {\r\n\t\t\t\t\t\tconsole.log(ex.data.msg);\r\n\t\t\t\t\t\tthis.isHistoryLoading = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\ttoVideo(url){\r\n\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\turl: \"../video/big-video?videoUrl=\" + url + \"&title=\" + \"视频\"\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tgetVideo(){\r\n\t\t\t\tthis.hideDrawer();\r\n\t\t\t\t// 上传视频\r\n\t\t\t\tuni.chooseVideo({\r\n\t\t\t\t    maxDuration:60,\r\n\t\t\t\t    count: 1,\r\n\t\t\t\t    success: (responent) => {\r\n\t\t\t\t        let videoFile = responent.tempFilePath;\r\n\t\t\t\t        console.log(\"要上传的视频\" );\r\n\t\t\t\t        console.log(videoFile );\r\n\t\t\t\t\t\t//对原视频先进行本地压缩\r\n\t\t\t\t\t\tthis.postVideo(videoFile);\r\n\t\t\t\t    }\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tpostVideo(videoFile){\r\n\t\t\t\tvar me=this;\r\n\t\t\t\tuni.showLoading();\r\n\t\t\t\tuni.uploadFile({\r\n\t\t\t\t \turl: this.websocketOtherSendUrl, \r\n\t\t\t\t \tfilePath: videoFile,\r\n\t\t\t\t \tname: 'file',\r\n\t\t\t\t \theader: {\r\n\t\t\t\t \t    'Content-Type': 'application/json',\r\n\t\t\t\t \t\t'token':uni.getStorageSync('token')\r\n\t\t\t\t \t},\r\n\t\t\t\t \tformData: {\r\n\t\t\t\t \t\t\"type\":4,\r\n\t\t\t\t \t\t\"chattingId\":me.id\r\n\t\t\t\t \t},\r\n\t\t\t\t \tsuccess: (uploadFileRes) => {\r\n\t\t\t\t \t\tuni.hideLoading();\r\n\t\t\t\t \t\tconsole.log(\"成功\");\r\n\t\t\t\t \t\tconsole.log(uploadFileRes); \r\n\t\t\t\t \t\tconsole.log(JSON.parse(uploadFileRes.data));\r\n\t\t\t\t \t\tvar res=JSON.parse(uploadFileRes.data);\r\n\t\t\t\t \t\tif (res.status == 0){\r\n\t\t\t\t \t\t    console.log('上传视频成功');\r\n\t\t\t\t \t\t\tme.getNewData();\r\n\t\t\t\t \t\t}else if(res.status==1){\r\n\t\t\t\t \t\t\tthis.$u.toast(res.msg);\r\n\t\t\t\t \t\t}\r\n\t\t\t\t \t }\r\n\t\t\t\t });\r\n\t\t\t},\r\n\t\t\t//触发滑动到顶部(加载历史信息记录)\r\n\t\t\tloadHistory(e){\r\n\t\t\t\tif(this.isHistoryLoading){\r\n\t\t\t\t\treturn ;\r\n\t\t\t\t}\r\n\t\t\t\tthis.pageNum++;\r\n\t\t\t\tthis.isHistoryLoading = true;//参数作为进入请求标识，防止重复请求\r\n\t\t\t\tthis.scrollAnimation = false;//关闭滑动动画\r\n\t\t\t\tlet Viewid = this.messageList[0].id;//记住第一个信息ID\r\n\t\t\t\t\tthis.$u.get(this.ChattingChatRecordUrl,{\r\n\t\t\t\t\t\t'id': this.id,\r\n\t\t\t\t\t\t'pageNum':this.pageNum,\r\n\t\t\t\t\t\t'pageSize':this.pageSize\r\n\t\t\t\t\t}).then(res=>{\r\n\t\t\t\t\t\tthis.isHistoryLoading = false;\r\n\t\t\t\t\t\tvar newData=res.data.list;\r\n\t\t\t\t\t\t// .reverse()\r\n\t\t\t\t\t\t// this.messageList=newData.concat(this.messageList);//数组翻转\r\n\t\t\t\t\t\t// 获取消息中的图片,并处理显示尺寸\r\n\t\t\t\t\t\tfor(let i=0;i<newData.length;i++){\r\n\t\t\t\t\t\t\tif(newData[i].type==2 ){\r\n\t\t\t\t\t\t\t\tthis.msgImgList.push(newData[i].content);\r\n\t\t\t\t\t\t\t} \r\n\t\t\t\t\t\t\tthis.messageList.unshift(newData[i]);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tconsole.log(\"所有消息\");\r\n\t\t\t\t\t\tconsole.log(this.messageList);\r\n\t\t\t\t\t\t//这段代码很重要，不然每次加载历史数据都会跳到顶部\r\n\t\t\t\t\t\tthis.$nextTick(function() {\r\n\t\t\t\t\t\t\tthis.scrollToView ='msg'+ Viewid;//跳转上次的第一行信息位置\r\n\t\t\t\t\t\t\t// uni.pageScrollTo({         //回到下拉之前，多展示一条消息\r\n\t\t\t\t\t\t\t// \tscrollTop: 'msg'+ Viewid,\r\n\t\t\t\t\t\t\t// \tduration: 0\r\n\t\t\t\t\t\t\t// });\r\n\t\t\t\t\t\t\tthis.$nextTick(function() {\r\n\t\t\t\t\t\t\t\tthis.scrollAnimation = true;//恢复滚动动画\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}).catch(ex=>{\r\n\t\t\t\t\t\tif(ex.data.status==4){\r\n\t\t\t\t\t\t\tthis.$u.toast(\"已加载全部消息\");\r\n\t\t\t\t\t\t\tthis.isHistoryLoading = false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t//更多功能(点击+弹出) \r\n\t\t\tshowMore(){\r\n\t\t\t\tthis.isVoice = false;\r\n\t\t\t\tif(this.hideMore){\r\n\t\t\t\t\tthis.hideMore = false;\r\n\t\t\t\t\tthis.openDrawer();\r\n\t\t\t\t}else{\r\n\t\t\t\t\tthis.hideDrawer();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t// 打开抽屉\r\n\t\t\topenDrawer(){\r\n\t\t\t\tthis.popupLayerClass = 'showLayer';\r\n\t\t\t},\r\n\t\t\t// 隐藏抽屉\r\n\t\t\thideDrawer(){\r\n\t\t\t\tthis.popupLayerClass = '';\r\n\t\t\t\tsetTimeout(()=>{\r\n\t\t\t\t\tthis.hideMore = true;\r\n\t\t\t\t},150);\r\n\t\t\t},\r\n\t\t\t//选照片 or 拍照\r\n\t\t\tgetImage(){\r\n\t\t\t\tthis.hideDrawer();\r\n\t\t\t\tvar me=this;\r\n\t\t\t\tuni.chooseImage({\r\n\t\t\t\t    count: 1, //默认9\r\n\t\t\t\t\tsizeType: ['compressed'],\r\n\t\t\t\t    success: function(res) {\r\n\t\t\t\t\t\t console.log(JSON.stringify(res.tempFilePaths[0]));\r\n\t\t\t\t\t\t console.log(me.id);\r\n\t\t\t\t\t\tme.sendImg(res.tempFilePaths[0]);\r\n\t\t\t\t    }\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t//发送图片\r\n\t\t\tsendImg(path){\r\n\t\t\t\tvar me=this;\r\n\t\t\t\tuni.showLoading();\r\n\t\t\t\tuni.uploadFile({\r\n\t\t\t\t\turl: this.websocketOtherSendUrl, \r\n\t\t\t\t\tfilePath: path,\r\n\t\t\t\t\tname: 'file',\r\n\t\t\t\t\theader: {\r\n\t\t\t\t\t    'Content-Type': 'application/json',\r\n\t\t\t\t\t\t'token':uni.getStorageSync('token')\r\n\t\t\t\t\t},\r\n\t\t\t\t\tformData: {\r\n\t\t\t\t\t\t\"type\":2,\r\n\t\t\t\t\t\t\"chattingId\":me.id\r\n\t\t\t\t\t },\r\n\t\t\t\t\t success: (uploadFileRes) => {\r\n\t\t\t\t\t\t uni.hideLoading();\r\n\t\t\t\t\t\tconsole.log(\"成功\");\r\n\t\t\t\t\t\tconsole.log(uploadFileRes); \r\n\t\t\t\t\t\tconsole.log(JSON.parse(uploadFileRes.data));\r\n\t\t\t\t\t\tvar res=JSON.parse(uploadFileRes.data);\r\n\t\t\t\t\t\tif (res.status == 0){\r\n\t\t\t\t\t\t    console.log('上传成功');\r\n\t\t\t\t\t\t\tme.getNewData();\r\n\t\t\t\t\t\t}else if(res.status==1){\r\n\t\t\t\t\t\t\tthis.$u.toast(res.msg);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t }\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t//获取焦点,则关闭抽屉\r\n\t\t\ttextareaFocus(){\r\n\t\t\t\tthis.focus=true;\r\n\t\t\t\tif(this.popupLayerClass=='showLayer'){\r\n\t\t\t\t\tthis.hideDrawer();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t// 发送文字消息\r\n\t\t\tsendText(){\r\n\t\t\t\tif(!this.textMsg){\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tthis.sendMsg(this.textMsg);\r\n\t\t\t\tthis.textMsg = '';//清空输入框\r\n\t\t\t},\r\n\t\t\t// 发送消息 请求接口\r\n\t\t\tsendMsg(content){\r\n\t\t\t\t//1文字 2图片 3语音 4视频\r\n\t\t\t\tconsole.log(\"要发送的信息\");\r\n\t\t\t\tconsole.log(content);\r\n\t\t\t\tthis.$u.post(this.websocketOtherSendUrl,{\r\n\t\t\t\t\tmessage:content,\r\n\t\t\t\t\ttype:1,\r\n\t\t\t\t\tchattingId:this.id\r\n\t\t\t\t}).then(res=>{\r\n\t\t\t\t\tthis.getNewData();\r\n\t\t\t\t\tconsole.log(\"发送消息成功\");\r\n\t\t\t\t\tconsole.log(res);\r\n\t\t\t\t}).catch(ex=>{\r\n\t\t\t\t\tthis.$u.toast(ex.data.msg);\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t//发送消息之后网络获取最新一条数据拼接在整个消息数据的后面\r\n\t\t\tgetNewData(){\r\n\t\t\t\tconsole.log(\"开始获取第一条消息\");\r\n\t\t\t\tthis.$u.get(this.ChattingChatRecordUrl,{\r\n\t\t\t\t\t'id': this.id,\r\n\t\t\t\t\t'pageNum':1,\r\n\t\t\t\t\t'pageSize':1\r\n\t\t\t\t}).then(res=>{\r\n\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t\tconst oneMessageData= res.data.list;\r\n\t\t\t\t\tconsole.log(\"最新获取到的消息\");\r\n\t\t\t\t\tconsole.log(oneMessageData);\r\n\t\t\t\t\tthis.messageList=this.messageList.concat(oneMessageData);//数据拼接\r\n\t\t\t\t\tconsole.log(\"滚动到最下面的id\");\r\n\t\t\t\t\tconsole.log(oneMessageData[0].id);\r\n\t\t\t\t\t//滚动到底部\r\n\t\t\t\t\tthis.$nextTick(function() {\r\n\t\t\t\t\t\t//进入页面滚动到底部\r\n\t\t\t\t\t\tthis.scrollToView = 'msg'+oneMessageData[0].id;\r\n\t\t\t\t\t\tthis.$nextTick(function() {\r\n\t\t\t\t\t\t\tthis.scrollAnimation = true;\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t\t// 获取消息中的图片,并处理显示尺寸\r\n\t\t\t\t\tif(oneMessageData[0].type==2 ){\r\n\t\t\t\t\t\tthis.msgImgList.push(oneMessageData[0].message);\r\n\t\t\t\t\t} \r\n\t\t\t\t\t//非自己的消息震动 0为客服消息 1为用户消息\r\n\t\t\t\t\tif(oneMessageData[0].creator==0){\r\n\t\t\t\t\t\tuni.vibrateLong();\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t// 预览图片 点击放大图\r\n\t\t\tshowPic(msg){\r\n\t\t\t\tuni.previewImage({\r\n\t\t\t\t\tindicator:\"none\",\r\n\t\t\t\t\tcurrent:msg,\r\n\t\t\t\t\turls: this.msgImgList\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t// 播放语音\r\n\t\t\tplayVoice(msg,id){\r\n\t\t\t\tthis.playMsgid=id;\r\n\t\t\t\tthis.AUDIO.src = msg;\r\n\t\t\t\tthis.$nextTick(function() {\r\n\t\t\t\t\tthis.AUDIO.play();\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t// 录音开始\r\n\t\t\tvoiceBegin(e){\r\n\t\t\t\tconsole.log(\"开始录制\");\r\n\t\t\t\tconsole.log(e);\r\n\t\t\t\tif(e.touches.length>1){\r\n\t\t\t\t\treturn ;\r\n\t\t\t\t}\r\n\t\t\t\tthis.initPoint.Y = e.touches[0].clientY;\r\n\t\t\t\tthis.initPoint.identifier = e.touches[0].identifier;\r\n\t\t\t\tthis.RECORDER.start({format:\"mp3\"});//录音开始,\r\n\t\t\t},\r\n\t\t\t//录音开始UI效果\r\n\t\t\trecordBegin(e){\r\n\t\t\t\tthis.recording = true;\r\n\t\t\t\tthis.voiceTis='松开 结束';\r\n\t\t\t\tthis.recordLength = 0;\r\n\t\t\t\tthis.recordTimer = setInterval(()=>{\r\n\t\t\t\t\tthis.recordLength++;\r\n\t\t\t\t},1000)\r\n\t\t\t},\r\n\t\t\t// 录音被打断\r\n\t\t\tvoiceCancel(){\r\n\t\t\t\tthis.recording = false;\r\n\t\t\t\tthis.voiceTis='按住 说话';\r\n\t\t\t\tthis.recordTis = '手指上滑 取消发送'\r\n\t\t\t\tthis.willStop = true;//不发送录音\r\n\t\t\t\tthis.RECORDER.stop();//录音结束\r\n\t\t\t},\r\n\t\t\t// 录音中(判断是否触发上滑取消发送)\r\n\t\t\tvoiceIng(e){\r\n\t\t\t\tif(!this.recording){\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tlet touche = e.touches[0];\r\n\t\t\t\t//上滑一个导航栏的高度触发上滑取消发送\r\n\t\t\t\tif(this.initPoint.Y - touche.clientY>=uni.upx2px(100)){\r\n\t\t\t\t\tthis.willStop = true;\r\n\t\t\t\t\tthis.recordTis = '松开手指 取消发送'\r\n\t\t\t\t}else{\r\n\t\t\t\t\tthis.willStop = false;\r\n\t\t\t\t\tthis.recordTis = '手指上滑 取消发送'\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t// 结束录音\r\n\t\t\tvoiceEnd(e){\r\n\t\t\t\tif(!this.recording){\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tthis.recording = false;\r\n\t\t\t\tthis.voiceTis='按住 说话';\r\n\t\t\t\tthis.recordTis = '手指上滑 取消发送'\r\n\t\t\t\tthis.RECORDER.stop();//录音结束\r\n\t\t\t},\r\n\t\t\t//录音结束(回调文件)\r\n\t\t\trecordEnd(e){\r\n\t\t\t\tvar me=this;\r\n\t\t\t\tclearInterval(this.recordTimer);\r\n\t\t\t\tif(!this.willStop){\r\n\t\t\t\t\tconsole.log(\"要上传的语音\");\r\n\t\t\t\t\tconsole.log(e.tempFilePath);\r\n\t\t\t\t\tconsole.log(\"要上传语音的时长\");\r\n\t\t\t\t\tconsole.log(this.recordLength);\r\n\t\t\t\t\tif(this.recordLength<1){\r\n\t\t\t\t\t\tthis.$u.toast(\"时间过短，请重新录制\");\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//上传文件\r\n\t\t\t\t\tuni.uploadFile({\r\n\t\t\t\t\t\turl: this.websocketOtherSendUrl,\r\n\t\t\t\t\t\tmethod:\"POST\",\r\n\t\t\t\t\t\tfilePath:e.tempFilePath,\r\n\t\t\t\t\t\tname: 'file',\r\n\t\t\t\t\t\theader: {\r\n\t\t\t\t\t\t    'Content-Type': 'application/json',\r\n\t\t\t\t\t\t\t'token':uni.getStorageSync('token')\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tformData: {\r\n\t\t\t\t\t\t\t\"type\":3,\r\n\t\t\t\t\t\t\t\"chattingId\":me.id\r\n\t\t\t\t\t\t },\r\n\t\t\t\t\t\t success: (uploadFileRes) => {\r\n\t\t\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t\t\t\tconsole.log(\"成功\");\r\n\t\t\t\t\t\t\tconsole.log(uploadFileRes); \r\n\t\t\t\t\t\t\tconsole.log(JSON.parse(uploadFileRes.data));\r\n\t\t\t\t\t\t\tvar res=JSON.parse(uploadFileRes.data);\r\n\t\t\t\t\t\t\tif (res.status == 0){\r\n\t\t\t\t\t\t\t    console.log('上传语音成功');\r\n\t\t\t\t\t\t\t\tme.getNewData();\r\n\t\t\t\t\t\t\t}else if(res.status==1){\r\n\t\t\t\t\t\t\t\tthis.$u.toast(res.msg);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t },\r\n\t\t\t\t\t})\r\n\t\t\t\t}else{\r\n\t\t\t\t\tconsole.log('取消发送录音');\r\n\t\t\t\t}\r\n\t\t\t\tthis.willStop = false;\r\n\t\t\t},\r\n\t\t\t// 切换语音/文字输入\r\n\t\t\tswitchVoice(){\r\n\t\t\t\tthis.hideDrawer();\r\n\t\t\t\tthis.isVoice = this.isVoice?false:true;\r\n\t\t\t},\r\n\t\t\tdiscard(){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</script>\r\n<style lang=\"scss\">\r\n\t@import \"chat.scss\";\r\n</style>\n","import mod from \"-!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--8-oneOf-1-0!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-1!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-2!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--8-oneOf-1-3!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\sass-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-4!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-5!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./kf-chat.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--8-oneOf-1-0!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-1!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-2!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--8-oneOf-1-3!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\sass-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-4!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-5!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./kf-chat.vue?vue&type=style&index=0&lang=scss&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1608888968010\n      var cssReload = require(\"D:/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}