{"version":3,"sources":["uni-app:///main.js","webpack:///F:/uniapp/sfb/sysf_customer_before/pages/chat/chat.vue?cbeb","webpack:///F:/uniapp/sfb/sysf_customer_before/pages/chat/chat.vue?3e7e","webpack:///F:/uniapp/sfb/sysf_customer_before/pages/chat/chat.vue?544c","webpack:///F:/uniapp/sfb/sysf_customer_before/pages/chat/chat.vue?c791","uni-app:///pages/chat/chat.vue","webpack:///F:/uniapp/sfb/sysf_customer_before/pages/chat/chat.vue?bc6e","webpack:///F:/uniapp/sfb/sysf_customer_before/pages/chat/chat.vue?dc7c"],"names":["createPage","Page"],"mappings":";;;;;;;;;;kDAAA;AACA;AACA,0F;AACAA,UAAU,CAACC,aAAD,CAAV,C;;;;;;;;;;;;;ACHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAiH;AACjH;AACwD;AACL;AACc;;;AAGjE;AACqK;AACrK,gBAAgB,+KAAU;AAC1B,EAAE,0EAAM;AACR,EAAE,+EAAM;AACR,EAAE,wFAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,mFAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;AC7BA;AAAA;AAAA;AAAA;AAA8lB,CAAgB,wnBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACkKlnB,+G;AACA;AACA,MADA,kBACA;AACA;AACA,kBADA,EACA;AACA,wBAFA,EAEA;AACA,cAHA;AAIA,iBAJA,EAIA;AACA,YALA,EAKA;AACA,aANA,EAMA;AACA,cAPA,EAOA;AACA,gBARA,EAQA;AACA,kBATA,EASA;AACA,oBAVA,EAUA;AACA,qBAXA;AAYA;AACA,iBAbA;AAcA;AACA,6BAfA;AAgBA,2BAhBA;AAiBA,kBAjBA;AAkBA,sBAlBA;AAmBA,iBAnBA;AAoBA,oBApBA;AAqBA,cArBA;;AAuBA;;AAEA;AACA,wCA1BA;;AA4BA,oBA5BA;AA6BA,uBA7BA;AA8BA,4BA9BA;AA+BA,sBA/BA;AAgCA,qBAhCA;AAiCA,wCAjCA;AAkCA,uBAlCA;AAmCA,qBAnCA;;AAqCA;AACA,0CAtCA;AAuCA,qBAvCA;AAwCA,sBAxCA;AAyCA;AACA,yBA1CA;AA2CA;AACA,oBA5CA;AA6CA,kBA7CA;;AA+CA,GAjDA;AAkDA,QAlDA,kBAkDA,MAlDA,EAkDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kBAPA,GAOA,iCAPA;AAQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAFA;AAGA,iBANA;AAOA;AACA;AACA,kCADA;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA,eAFA;AAGA;AACA;AACA;AACA,eAFA;;;AAKA;AACA;AACA;AACA;AACA;AACA;AACA,eAJA,MAIA;AACA;AACA;;;;;;;;;;;;AAYA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAVA;AAWA;AACA;AACA;AACA;AACA;AACA,eAJA;;;;AAQA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,+EADA,CACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAFA;AAGA,mBANA;;AAQA;AACA;AACA;AACA;AACA;AACA,eAxBA;AAyBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eATA,EAtHA;AAgIA,GAlLA;AAmLA,QAnLA,oBAmLA;AACA;AACA,GArLA;AAsLA,QAtLA,oBAsLA;AACA;AACA,GAxLA;AAyLA,UAzLA,sBAyLA;AACA;AACA;AACA,GA5LA;AA6LA;AACA;AACA,YAFA,oBAEA,QAFA,EAEA;AACA;AACA,0DADA;;AAGA,KANA;AAOA;AACA,UARA,kBAQA,QARA,EAQA;AACA;AACA,sEADA;;AAGA,KAZA;AAaA;AACA,gBAdA,wBAcA,EAdA,EAcA;AACA;AACA,oDADA;;AAGA,KAlBA;AAmBA,WAnBA,mBAmBA,GAnBA,EAmBA;AACA;AACA,oEADA;;AAGA,KAvBA;AAwBA,YAxBA,sBAwBA;AACA;AACA;AACA;AACA;AACA,uBADA;AAEA,gBAFA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+BADA;AAEA,0BAFA;AAGA,+BAHA;AAIA,wBAJA;AAKA;AACA,2BADA;AAEA,kCAFA;AAGA,4BAHA,EALA;;AAUA;AACA,uCADA,CACA;AACA;AACA;AACA,aAdA;;AAgBA,SA1BA;;AA4BA,KAxDA;AAyDA;AACA,kBA1DA,4BA0DA;AACA;AACA,gCADA;AAEA,+BAFA;AAGA,iCAHA;AAIA,UAJA,CAIA;AACA;AACA;AACA;AACA;AACA,qCALA,CAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAFA;AAGA,SANA;AAOA,OA3BA,EA2BA,KA3BA,CA2BA;AACA;AACA;AACA;AACA;AACA,OAhCA;AAiCA,KA5FA;AA6FA;AACA,eA9FA,uBA8FA,CA9FA,EA8FA;AACA;AACA;AACA;AACA;AACA,mCALA,CAKA;AACA,mCANA,CAMA;AACA,0CAPA,CAOA;AACA;AACA,gCADA;AAEA,+BAFA;AAGA,iCAHA;AAIA,UAJA,CAIA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,6CADA,CACA;AACA;AACA;AACA;AACA;AACA;AACA,wCADA,CACA;AACA,WAFA;AAGA,SATA;AAUA,OA/BA,EA+BA,KA/BA,CA+BA;AACA;AACA;AACA;AACA;AACA,OApCA;AAqCA,KA3IA;;AA6IA;AACA,YA9IA,sBA8IA;AACA;AACA;AACA;AACA;AACA,OAHA,MAGA;AACA;AACA;AACA,KAtJA;AAuJA;AACA,cAxJA,wBAwJA;AACA;AACA,KA1JA;AA2JA;AACA,cA5JA,wBA4JA;AACA;AACA;AACA;AACA,OAFA,EAEA,GAFA;AAGA,KAjKA;;AAmKA;AACA,YApKA,sBAoKA;AACA;AACA;AACA;AACA,gBADA,EACA;AACA,gCAFA;AAGA;AACA;AACA;AACA;AACA;AACA,SARA;;AAUA,KAjLA;AAkLA;AACA,WAnLA,mBAmLA,IAnLA,EAmLA;AACA;AACA;AACA;AACA,6BADA;AAEA,sBAFA;AAGA,oBAHA;AAIA;AACA,yBADA;AAEA,gCAFA;AAGA,wBAHA,EAJA;;AASA;AACA;AACA;AACA;AACA,SAbA;;AAeA,KArMA;AAsMA;AACA,iBAvMA,2BAuMA;AACA;AACA;AACA;AACA;AACA,KA5MA;AA6MA;AACA,YA9MA,sBA8MA;AACA;AACA;AACA;AACA;AACA,wBALA,CAKA;;AAEA,KArNA;AAsNA;AACA,WAvNA,mBAuNA,OAvNA,EAuNA,IAvNA,EAuNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBADA,GACA,OADA,GACA,GADA;AAEA,kBAFA,GAEA,IAFA,GAEA,GAFA;AAGA,aAHA,GAGA,OAHA,GAGA,GAHA;AAIA,aAJA,GAIA,OAJA,GAIA,GAJA;AAKA,eALA,GAKA,YALA;AAMA,UANA,CAMA;AACA;AACA;AACA;AACA,OAVA;AAWA,KA1OA;;AA4OA;AACA,cA7OA,wBA6OA;AACA;AACA;AACA,gCADA;AAEA,oBAFA;AAGA,qBAHA;AAIA,UAJA,CAIA;AACA;AACA;AACA;AACA;;AAEA,uEANA,CAMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAFA;AAGA,SANA;;;AASA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,OAhCA;AAiCA,KAhRA;AAiRA;AACA,WAlRA,mBAkRA,GAlRA,EAkRA;AACA;AACA,yBADA;AAEA,oBAFA;AAGA,6BAHA;;AAKA,KAxRA;AAyRA;AACA,aA1RA,qBA0RA,GA1RA,EA0RA,EA1RA,EA0RA;AACA;AACA;AACA;AACA;AACA,OAFA;AAGA,KAhSA;AAiSA;AACA,cAlSA,sBAkSA,CAlSA,EAkSA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6CARA,CAQA;AACA,KA3SA;AA4SA;AACA,eA7SA,uBA6SA,CA7SA,EA6SA;AACA;AACA;AACA;AACA;AACA;AACA,OAFA,EAEA,IAFA;AAGA,KApTA;AAqTA;AACA,eAtTA,yBAsTA;AACA;AACA;AACA;AACA,2BAJA,CAIA;AACA,2BALA,CAKA;AACA,KA5TA;AA6TA;AACA,YA9TA,oBA8TA,CA9TA,EA8TA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAHA,MAGA;AACA;AACA;AACA;AACA,KA3UA;AA4UA;AACA,YA7UA,oBA6UA,CA7UA,EA6UA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BAPA,CAOA;AACA,KArVA;AAsVA;AACA,aAvVA,qBAuVA,CAvVA,EAuVA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6BADA;AAEA,wBAFA;AAGA,kCAHA;AAIA,sBAJA;AAKA;AACA,yBADA;AAEA,gCAFA;AAGA,0BAHA;AAIA,wCAJA,EALA;;AAWA;AACA,qCADA,CACA;AACA;AACA;AACA,WAfA;;AAiBA,OAnCA,MAmCA;AACA;AACA;AACA;AACA,KAjYA;AAkYA;AACA,eAnYA,yBAmYA;AACA;AACA;AACA,KAtYA;AAuYA,WAvYA,qBAuYA;AACA;AACA,KAzYA,EA7LA,E;;;;;;;;;;;;;ACnKA;AAAA;AAAA;AAAA;AAAgmC,CAAgB,0kCAAG,EAAC,C;;;;;;;;;;;ACApnC;AACA,OAAO,KAAU,EAAE,kBAKd","file":"pages/chat/chat.js","sourcesContent":["import 'uni-pages';\nimport Vue from 'vue'\nimport Page from './pages/chat/chat.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./chat.vue?vue&type=template&id=bf16e7f4&\"\nvar renderjs\nimport script from \"./chat.vue?vue&type=script&lang=js&\"\nexport * from \"./chat.vue?vue&type=script&lang=js&\"\nimport style0 from \"./chat.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\runtime\\\\componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/chat/chat.vue\"\nexport default component.exports","export * from \"-!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\templateLoader.js??vue-loader-options!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--16-0!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\template.js!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-uni-app-loader\\\\page-meta.js!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./chat.vue?vue&type=template&id=bf16e7f4&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var l0 = _vm.__map(_vm.messageList, function(row, index) {\n    var $orig = _vm.__get_orig(row)\n\n    var g0 =\n      row.sendId == _vm.account && row.mediaType != 3 && row.mediaType == 1\n        ? row.content.replace(/\\n/g, \"<br>\")\n        : null\n    return {\n      $orig: $orig,\n      g0: g0\n    }\n  })\n\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        l0: l0\n      }\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./chat.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./chat.vue?vue&type=script&lang=js&\"","<template>\r\n\t<view>\r\n\t\t<view class=\"content\" @touchstart=\"hideDrawer\">\r\n\t\t\t<scroll-view class=\"msg-list\" scroll-y=\"true\" :scroll-with-animation=\"scrollAnimation\" :scroll-top=\"scrollTop\"\r\n\t\t\t :scroll-into-view=\"scrollToView\" @scrolltoupper=\"loadHistory\" upper-threshold=\"50\">\r\n\t\t\t\t<!-- 加载历史数据waitingUI -->\r\n\t\t\t\t<view class=\"loading\" v-if=\"isHistoryLoading\">\r\n\t\t\t\t\t<view class=\"spinner\">\r\n\t\t\t\t\t\t<view class=\"rect1\"></view>\r\n\t\t\t\t\t\t<view class=\"rect2\"></view>\r\n\t\t\t\t\t\t<view class=\"rect3\"></view>\r\n\t\t\t\t\t\t<view class=\"rect4\"></view>\r\n\t\t\t\t\t\t<view class=\"rect5\"></view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"row\" v-for=\"(row,index) in messageList\" :key=\"index\" :id=\"'msg'+row.id\">\r\n\t\t\t\t\t<!-- 自己发出的消息 -->\r\n\t\t\t\t\t<view class=\"my\" v-if=\"row.sendId!=account&& row.mediaType!=4\">\r\n\t\t\t\t\t\t<!-- 左-消息 -->\r\n\t\t\t\t\t\t<view class=\"left\">\r\n\t\t\t\t\t\t\t<!-- 文字消息 -->\r\n\t\t\t\t\t\t\t<view v-if=\"row.mediaType==1\" class=\"bubble\">\r\n\t\t\t\t\t\t\t\t<rich-text :nodes=\"row.content\"></rich-text>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t<!-- 语音消息 -->\r\n\t\t\t\t\t\t\t<view v-if=\"row.mediaType==6\" class=\"bubble voice\" @tap=\"playVoice(row.content,row.id)\" :class=\"playMsgid == row.id?'play':''\">\r\n\t\t\t\t\t\t\t\t<view class=\"length\">{{row.length}}''</view>\r\n\t\t\t\t\t\t\t\t<view class=\"icon my-voice\"></view>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t<!-- 图片消息 -->\r\n\t\t\t\t\t\t\t<view v-if=\"row.mediaType==2\" class=\"bubble img\" @tap=\"showPic(row.content)\">\r\n\t\t\t\t\t\t\t\t<!-- :style=\"{'width': row.content.width+'px','height': row.content.height+'px'}\" -->\r\n\t\t\t\t\t\t\t\t<!--阿里云图片压缩 缩放图 -->\r\n\t\t\t\t\t\t\t\t<image lazy-load mode=\"aspectFill\" :src=\"row.content+'?x-oss-process=image/resize,l_150'\"></image>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t<!-- 视频消息  class=\"tui-video\" -->\r\n\t\t\t\t\t\t\t<view v-if=\"row.mediaType==7\" class=\"bubble video\">\r\n\t\t\t\t\t\t\t\t<view style=\"position: relative;\" @tap=\"toVideo(row.content)\">\r\n\t\t\t\t\t\t\t\t\t<!-- 视频截图 第一帧 -->\r\n\t\t\t\t\t\t\t\t\t<image style=\"border-radius: 12rpx;width: 250rpx; height: 300rpx;\" :src=\"row.content+'?x-oss-process=video/snapshot,t_1000,m_fast'\"\r\n\t\t\t\t\t\t\t\t\t mode=\"aspectFill\"></image>\r\n\t\t\t\t\t\t\t\t\t<view style=\"width: 100%; height: 100%; position: absolute;top:0%; left: 0%;display: flex;flex-direction: column;align-items: center;justify-content: center;\"\r\n\t\t\t\t\t\t\t\t\t @tap=\"toVideo(row.content)\">\r\n\t\t\t\t\t\t\t\t\t\t<image style=\" width: 50rpx; height:50rpx;\" src=\"../../static/image/icon_play.png\" mode=\"aspectFill\"></image>\r\n\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<!-- 右-头像 -->\r\n\t\t\t\t\t\t<view class=\"right\">\r\n\t\t\t\t\t\t\t<image style=\"border-radius: 100rpx;\" mode=\"aspectFill\" :src=\"imageUrl==null ?'../../static/image/icon_tx_nor.png':imageUrl\"></image>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<!-- 收到医生的问诊单 -->\r\n\t\t\t\t\t<view class=\"view-right\" v-if=\"row.mediaType==3 \" @tap=\"toUpbill(row.recordId)\">\r\n\t\t\t\t\t\t<view class=\"right-time\">{{row.createTime}}</view>\r\n\t\t\t\t\t\t<view class=\"right-media-type-up\">{{row.content}}</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<!-- 查看自己提交的问诊单 -->\r\n\t\t\t\t\t<view class=\"view-right\" v-if=\"row.mediaType==4\" @tap=\"tobill(row.recordId)\">\r\n\t\t\t\t\t\t<view class=\"right-time\">{{row.createTime}}</view>\r\n\t\t\t\t\t\t<view class=\"right-media-type\">{{row.content}}</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<!-- 别人发出的消息 -->\r\n\t\t\t\t\t<view class=\"other\" v-if=\"row.sendId==account\">\r\n\t\t\t\t\t\t<view class=\"right\" v-if=\"row.mediaType!=3\">\r\n\t\t\t\t\t\t\t<view class=\"right-time\">{{row.createTime}}</view>\r\n\t\t\t\t\t\t\t<view class=\"other\">\r\n\t\t\t\t\t\t\t\t<!-- 左-头像 -->\r\n\t\t\t\t\t\t\t\t<view class=\"left\">\r\n\t\t\t\t\t\t\t\t\t<image style=\"border-radius: 100rpx;\" :src=\"img\"></image>\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t<!-- 右-用户名称-时间-消息 -->\r\n\r\n\t\t\t\t\t\t\t\t<!-- 文字消息 -->\r\n\t\t\t\t\t\t\t\t<view v-if=\"row.mediaType==1\" class=\"bubble\">\r\n\t\t\t\t\t\t\t\t\t<rich-text :nodes=\"row.content.replace(/\\n/g,'<br>')\"></rich-text>\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t<!-- 语音消息 -->\r\n\t\t\t\t\t\t\t\t<view v-if=\"row.mediaType==6\" class=\"bubble voice\" @tap=\"playVoice(row.content,row.id)\" :class=\"playMsgid == row.id?'play':''\">\r\n\t\t\t\t\t\t\t\t\t<view class=\"icon other-voice\"></view>\r\n\t\t\t\t\t\t\t\t\t<view class=\"length\">{{row.length}}''</view>\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t<!-- 图片消息 -->\r\n\t\t\t\t\t\t\t\t<view v-if=\"row.mediaType==2\" class=\"bubble img\" @tap=\"showPic(row.content)\">\r\n\t\t\t\t\t\t\t\t\t<image lazy-load mode=\"aspectFill\" :src=\"row.content+'?x-oss-process=image/resize,l_150'\"></image>\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t<!-- 推荐商品 -->\r\n\t\t\t\t\t\t\t\t<view v-if=\"row.mediaType==5\" class=\"bubble recommend\" @tap=\"toGoodDetail(row.goods.id)\" style=\"justify-content: flex-start;align-items: flex-start; align-self: flex-start;background-color: #FFFFFF;\">\r\n\t\t\t\t\t\t\t\t\t<image mode=\"aspectFill\" :src=\"row.goods.img\"></image>\r\n\t\t\t\t\t\t\t\t\t<view class=\"view-recommend\">\r\n\t\t\t\t\t\t\t\t\t\t<view class=\"txt-name\">{{row.goods.name}}</view>\r\n\t\t\t\t\t\t\t\t\t\t<view class=\"txt-subtitle\">{{row.goods.subTitle}}</view>\r\n\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</scroll-view>\r\n\t\t</view>\r\n\r\n\t\t<!-- 抽屉栏 -->\r\n\t\t<view class=\"popup-layer\" :class=\"popupLayerClass\" @touchmove.stop.prevent=\"discard\">\r\n\t\t\t<!-- 更多功能 相册-拍照 -->\r\n\t\t\t<view class=\"more-layer\" :class=\"{hidden:hideMore}\">\r\n\t\t\t\t<view class=\"list\">\r\n\t\t\t\t\t<view style=\"display: flex;justify-content: center; justify-content: center;flex-direction: column;\">\r\n\t\t\t\t\t\t<view class=\"box\" @tap=\"getImage\">\r\n\t\t\t\t\t\t\t<image style=\"width: 50rpx; height: 40rpx;\" src=\"../../static/image/icon_tp1.png\" mode=\"aspectFill\"></image>\r\n\t\t\t\t\t\t\t<!-- <view class=\"icon tupian2\"></view> -->\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<view style=\"width: 100%; text-align:center;\">图片</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view style=\"display: flex;justify-content: center; justify-content: center;flex-direction: column;\">\r\n\t\t\t\t\t\t<view class=\"box\" @tap=\"getVideo\">\r\n\t\t\t\t\t\t\t<image style=\"width: 50rpx; height: 40rpx;\" src=\"../../static/image/icon_sp.png\" mode=\"aspectFill\"></image>\r\n\t\t\t\t\t\t\t<!-- <view class=\"icon paizhao\"></view> -->\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<view style=\"width: 100%; text-align:center;\">视频</view>\r\n\t\t\t\t\t</view>\r\n\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t<!-- 底部输入栏 -->\r\n\t\t<view class=\"input-box\" :class=\"popupLayerClass\" @touchmove.stop.prevent=\"discard\">\r\n\t\t\t<!-- H5下不能录音，输入栏布局改动一下 -->\r\n\t\t\t<!-- #ifndef H5 -->\r\n\t\t\t<view class=\"voice\">\r\n\t\t\t\t<view class=\"icon\" :class=\"isVoice?'jianpan':'yuyin'\" @tap=\"switchVoice\"></view>\r\n\t\t\t</view>\r\n\t\t\t<!-- #endif -->\r\n\r\n\t\t\t<view class=\"textbox\">\r\n\t\t\t\t<view class=\"voice-mode\" :class=\"[isVoice?'':'hidden',recording?'recording':'']\" @touchstart=\"voiceBegin\"\r\n\t\t\t\t @touchmove.stop.prevent=\"voiceIng\" @touchend=\"voiceEnd\" @touchcancel=\"voiceCancel\">{{voiceTis}}</view>\r\n\t\t\t\t<view class=\"text-mode\" :class=\"isVoice?'hidden':''\">\r\n\t\t\t\t\t<view class=\"box\">\r\n\t\t\t\t\t\t<!-- cursor-spacing=\"20\" 设置弹出框跟输入框之间的距离 -->\r\n\t\t\t\t\t\t<textarea cursor-spacing=\"20\" :focus=\"focus\" auto-height=\"true\" v-model=\"textMsg\" @focus=\"textareaFocus\" />\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t<!-- #ifndef H5 -->\r\n\t\t\t<view class=\"more\" @tap=\"showMore\">\r\n\t\t\t\t<view class=\"icon add\"></view>\r\n\t\t\t</view>\r\n\t\t\t<!-- #endif -->\r\n\t\t\t<view class=\"send\" :class=\"isVoice?'hidden':''\" @touchend.prevent=\"sendText\">\r\n\t\t\t\t<view class=\"btn\">发送</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t<!-- 录音UI效果 -->\r\n\t\t<view class=\"record\" :class=\"recording?'':'hidden'\">\r\n\t\t\t<view class=\"ing\" :class=\"willStop?'hidden':''\"><view class=\"icon luyin2\" ></view></view>\r\n\t\t\t<view class=\"cancel\" :class=\"willStop?'':'hidden'\"><view class=\"icon chehui\" ></view></view>\r\n\t\t\t<view class=\"tis\" :class=\"willStop?'change':''\">{{recordTis}}</view>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n<script>\r\n\timport permision from \"@/js_sdk/wa-permission/permission.js\"\r\n\texport default {\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tplatform:'',//平台\r\n\t\t\t\tisJurisdiction:'',//录音权限\r\n\t\t\t\ttype:'',\r\n\t\t\t\taccount:'',//对方账号\r\n\t\t\t\tid:'',//用户账号id\r\n\t\t\t\timg:'',//对方头像\r\n\t\t\t\tname:'',//对方用户名称\r\n\t\t\t\tpageNum:1,//页数\r\n\t\t\t\tpageSize:20,//每页条数\r\n\t\t\t\timageUrl: null,//自己头像\r\n\t\t\t\tmessageList:[],\r\n\t\t\t\t//文字消息\r\n\t\t\t\ttextMsg:'',\r\n\t\t\t\t//消息列表\r\n\t\t\t\tisHistoryLoading:false,\r\n\t\t\t\tscrollAnimation:true,\r\n\t\t\t\tscrollTop:0,\r\n\t\t\t\tscrollToView:'',\r\n\t\t\t\tmsgList:[],\r\n\t\t\t\tmsgImgList:[],\r\n\t\t\t\tmyuid:0,\r\n\t\t\t\t\r\n\t\t\t\t//录音相关参数\r\n\t\t\t\t// #ifndef H5\r\n\t\t\t\t//H5不能录音\r\n\t\t\t\tRECORDER:uni.getRecorderManager(),\r\n\t\t\t\t// #endif\r\n\t\t\t\tisVoice:false,\r\n\t\t\t\tvoiceTis:'按住 说话',\r\n\t\t\t\trecordTis:\"手指上滑 取消发送\",\r\n\t\t\t\trecording:false,\r\n\t\t\t\twillStop:false,\r\n\t\t\t\tinitPoint:{identifier:0,Y:0},\r\n\t\t\t\trecordTimer:null,\r\n\t\t\t\trecordLength:0,\r\n\t\t\t\t\r\n\t\t\t\t//播放语音相关参数\r\n\t\t\t\tAUDIO:uni.createInnerAudioContext(),\r\n\t\t\t\tplayMsgid:null,\r\n\t\t\t\tVoiceTimer:null,\r\n\t\t\t\t// 抽屉参数\r\n\t\t\t\tpopupLayerClass:'',\r\n\t\t\t\t// more参数\r\n\t\t\t\thideMore:true,\r\n\t\t\t\tfocus:false,\r\n\t\t\t};\r\n\t\t},\r\n\t\tasync onLoad(option) {\r\n\t\t\t console.log(\"我的id：\"+ uni.getStorageSync(this.ID));\r\n\t\t\tthis.type=option.type;\r\n\t\t\tthis.account=option.account;\r\n\t\t\tthis.name=option.name;\r\n\t\t\tthis.img=JSON.parse(decodeURIComponent(option.img));\r\n\t\t\tthis.id='customer_'+uni.getStorageSync(this.ID);\r\n\t\t\tlet mess=uni.getStorageSync(this.account);\r\n\t\t\tif(!this.$u.test.isEmpty(mess)){\r\n\t\t\t\tthis.messageList=mess;\r\n\t\t\t\tconsole.log(\"获取到缓存的数据\");\r\n\t\t\t\tconsole.log(this.messageList);\r\n\t\t\t\t// 滚动到底部\r\n\t\t\t\tthis.$nextTick(function() {\r\n\t\t\t\t\t//进入页面滚动到底部\r\n\t\t\t\t\tthis.scrollTop = 9999;\r\n\t\t\t\t\tthis.$nextTick(function() {\r\n\t\t\t\t\t\tthis.scrollAnimation = true;\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tuni.setNavigationBarTitle({\r\n\t\t\t　　title:option.name\r\n\t\t\t});\r\n\t\t\tthis.getMessageData();\r\n\t\t\tconsole.log(\"头像\");\r\n\t\t\t// console.log(uni.getStorageSync(this.HEADIMG));\r\n\t\t\t// if(uni.getStorageSync(this.HEADIMG).length){\r\n\t\t\t\tthis.imageUrl=uni.getStorageSync(this.HEADIMG);\r\n\t\t\t// }else{\r\n\t\t\t\t// this.imageUrl=null\r\n\t\t\t// }\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t//语音自然播放结束\r\n\t\t\tthis.AUDIO.onEnded((res)=>{\r\n\t\t\t\tthis.playMsgid=null;\r\n\t\t\t});\r\n\t\t\t//提交问诊单后通知\r\n\t\t\tuni.$on(this.INFORMCHATLIST,data=>{\r\n\t\t\t\tthis.getNewData();\r\n\t\t\t})\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t//初始获取录音权限状态\r\n\t\t\tthis.platform = uni.getSystemInfoSync().platform\r\n\t\t\t if (this.platform == 'ios') {\r\n\t\t\t\tconsole.log('我是iOS')\r\n\t\t\t\t//有权限返回true，否则返回false\r\n\t\t\t\tthis.isJurisdiction=permision.judgeIosPermission(\"record\");\r\n\t\t\t} else if (this.platform == 'android') {\r\n\t\t\t\tconsole.log('我是安卓')\r\n\t\t\t\t/* 获取当前手机是否有录音权限 */\r\n\t\t\t\t// #ifdef APP-PLUS\r\n\t\t\t\tvar androidJurisdiction=await permision.requestAndroidPermission('android.permission.RECORD_AUDIO');\r\n\t\t\t\t//1\t已获取授权 0\t未获取授权 -1被永久拒绝授权\r\n\t\t\t\tif( androidJurisdiction==0){\r\n\t\t\t\t\tthis.isJurisdiction=false;\r\n\t\t\t\t}else if(androidJurisdiction==1){\r\n\t\t\t\t\tthis.isJurisdiction=true;\r\n\t\t\t\t}else if(androidJurisdiction==-1){\r\n\t\t\t\t\tthis.isJurisdiction=false;\r\n\t\t\t\t}\r\n\t\t\t\t// #endif\r\n\t\t\t\t/* 获取当前手机是否有录音权限 */\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// #ifndef H5\r\n\t\t\t//录音开始事件\r\n\t\t\tthis.RECORDER.onStart((e)=>{\r\n\t\t\t\t//没有权限情况 申请权限弹框 \r\n\t\t\t\t// Android会在允许权限之后重新赋值isJurisdiction为true 所以直接跳过了当前的if\r\n\t\t\t\t//ios则需要重新新获取权限的状态\r\n\t\t\t\tif (!this.isJurisdiction && this.platform == 'ios') {\r\n\t\t\t\t\tthis.isJurisdiction=permision.judgeIosPermission(\"record\");\r\n\t\t\t\t}\r\n\t\t\t\tif(this.isJurisdiction){\r\n\t\t\t\t\tthis.recordBegin(e);\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t//录音结束事件\r\n\t\t\tthis.RECORDER.onStop((e)=>{\r\n\t\t\t\tif(this.isJurisdiction){\r\n\t\t\t\t\tthis.recordEnd(e);\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t// #endif\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t// 接受到消息的监听 只要开启服务收到消息就会得到监听\r\n\t\t\t// (也就是不管在跟那个医生的聊天页面只要患者发送消息就会监听到发送的消息) \r\n\t\t\t// 所以要判断是否在当前页面 sendId==this.account\r\n\t\t\t\r\n\t\t\tuni.$on(this.SOCKETCHAT,data=>{\r\n\t\t\t\tconsole.log(\"收到嘻嘻嘻1111\");\r\n\t\t\t\tconsole.log(data);\r\n\t\t\t\t  \r\n\t\t\t\tvar oneMessageData=data;\r\n\t\t\t\t  //非自己的消息震动\r\n\t\t\t\t  if(oneMessageData.sendId==this.account){\r\n\t\t\t\t\t  this.messageList=this.messageList.concat(oneMessageData);//数据拼接\r\n\t\t\t\t\t  console.log(\"滚动到最下面的id\");\r\n\t\t\t\t\t  console.log(oneMessageData.id);\r\n\t\t\t\t\t  //滚动到底部\r\n\t\t\t\t\t  this.$nextTick(function() {\r\n\t\t\t\t\t\t//进入页面滚动到底部\r\n\t\t\t\t\t\tthis.scrollToView = 'msg'+oneMessageData.id;\r\n\t\t\t\t\t\tthis.$nextTick(function() {\r\n\t\t\t\t\t\t\tthis.scrollAnimation = true;\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t  });\r\n\t\t\t\t  \r\n\t\t\t\t\t// 获取消息中的图片,并处理显示尺寸\r\n\t\t\t\t\t  if(oneMessageData.mediaType==2 ){\r\n\t\t\t\t\t\tthis.msgImgList.push(oneMessageData.content);\r\n\t\t\t\t\t  } \r\n\t\t\t\t  }\r\n\t\t\t});\r\n\t\t\tuni.onKeyboardHeightChange(res => {\r\n\t\t\t\tconsole.log(\"软键盘高度监听\"+res.height);\r\n\t\t\t\t//监听软键盘的高度 \r\n\t\t\t\t//当点击软键盘自带的收起按钮的时候也就是会隐藏软键盘 这时候监听到的软键盘的高度就是0 、\r\n\t\t\t\t//让输入框取消焦点 这时候再去输入内容的时候 输入框就会弹起\r\n\t\t\t\tif(res.height==0){\r\n\t\t\t\t\tthis.focus=false;\r\n\t\t\t\t\tthis.hideDrawer();\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t},\r\n\t\tonShow(){\r\n\t\t\tthis.scrollTop = 9999999;\r\n\t\t},\r\n\t\tonHide() {\r\n\t\t\tthis.hideDrawer();\r\n\t\t},\r\n\t\tonUnload() {\r\n\t\t\tuni.$off(this.INFORMCHATLIST);\r\n\t\t\tuni.$off(this.SOCKETCHAT);\r\n\t\t},\r\n\t\tmethods:{\r\n\t\t\t//去提交问诊单\r\n\t\t\ttoUpbill(recordId){\r\n\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\turl:\"../bill-list/bill-list?recordId=\"+recordId\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t//查看问诊单\r\n\t\t\ttobill(recordId){\r\n\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\turl:\"../bill-list-check/bill-list-check?recordId=\"+recordId\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t//医生推荐商品点击去详情购买产品\r\n\t\t\ttoGoodDetail(id) {\r\n\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\turl: \"../shop-details/shop-details?id=\" + id\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\ttoVideo(url){\r\n\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\turl: \"../video/big-video?videoUrl=\" + url + \"&title=\" + \"视频\"\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tgetVideo(){\r\n\t\t\t\tthis.hideDrawer();\r\n\t\t\t\tvar me=this;\r\n\t\t\t\t// 上传视频\r\n\t\t\t\tuni.chooseVideo({\r\n\t\t\t\t    maxDuration:60,\r\n\t\t\t\t    count: 1,\r\n\t\t\t\t    success: (responent) => {\r\n\t\t\t\t        let videoFile = responent.tempFilePath;\r\n\t\t\t\t        console.log(\"要上传的视频\" );\r\n\t\t\t\t        console.log(videoFile );\r\n\t\t\t\t\t\t//对原视频先进行本地压缩\r\n\t\t\t\t\t\t//bug\r\n\t\t\t\t\t\tuni.showLoading();\r\n\t\t\t\t       uni.uploadFile({\r\n\t\t\t\t            url:me.sendChatUrl,\r\n\t\t\t\t            method:\"POST\",\r\n\t\t\t\t            filePath:videoFile,\r\n\t\t\t\t            name:'file',\r\n\t\t\t\t\t\t\tformData: {\r\n\t\t\t\t\t\t\t\t'from': me.id,\r\n\t\t\t\t\t\t\t\t'toUser': me.account,\r\n\t\t\t\t\t\t\t\t'mediaType':7\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t            success: (res) => {                    \r\n\t\t\t\t                let videoUrls = res.data //百度支持\r\n\t\t\t\t                console.log(\"上传视频成功\" + videoUrls);\r\n\t\t\t\t\t\t\t\tme.getNewData();\r\n\t\t\t\t            }\r\n\t\t\t\t        })\r\n\t\t\t\t    }\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t//获取聊天信息列表 加载初始页面消息\r\n\t\t\tgetMessageData(){\r\n\t\t\t\tthis.$u.get(this.customerMsgRecordUrl,{\r\n\t\t\t\t\t'receiver':this.account,\r\n\t\t\t\t\t'pageNum':this.pageNum,\r\n\t\t\t\t\t'pageSize':this.pageSize\r\n\t\t\t\t}).then(res=>{\r\n\t\t\t\t\tif(this.type==1){\r\n\t\t\t\t\t\tuni.$emit(this.INFORMNOREAD,'');\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvar newData = res.data.reverse();\r\n\t\t\t\t\tthis.messageList=newData;//数组翻转\r\n\t\t\t\t\tuni.setStorageSync(this.account,this.messageList);\r\n\t\t\t\t\tconsole.log(\"去缓存的数据\");\r\n\t\t\t\t\tconsole.log(this.messageList);\r\n\t\t\t\t\t// 获取消息中的图片,并处理显示尺寸\r\n\t\t\t\t\tfor(let i=0;i<newData.length;i++){\r\n\t\t\t\t\t\tif(newData[i].mediaType==2 ){\r\n\t\t\t\t\t\t\tthis.msgImgList.push(newData[i].content);\r\n\t\t\t\t\t\t} \r\n\t\t\t\t\t}\r\n\t\t\t\t\t// 滚动到底部\r\n\t\t\t\t\tthis.$nextTick(function() {\r\n\t\t\t\t\t\t//进入页面滚动到底部\r\n\t\t\t\t\t\tthis.scrollTop = 9999;\r\n\t\t\t\t\t\tthis.$nextTick(function() {\r\n\t\t\t\t\t\t\tthis.scrollAnimation = true;\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t}).catch(ex=>{\r\n\t\t\t\t\tif(ex.data.status==4){\r\n\t\t\t\t\t\tconsole.log(ex.data.msg);\r\n\t\t\t\t\t\tthis.isHistoryLoading=false; \r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t//触发滑动到顶部(加载历史信息记录)\r\n\t\t\tloadHistory(e){\r\n\t\t\t\tif(this.isHistoryLoading){\r\n\t\t\t\t\treturn ;\r\n\t\t\t\t}\r\n\t\t\t\tthis.pageNum++;\r\n\t\t\t\tthis.isHistoryLoading = true;//参数作为进入请求标识，防止重复请求\r\n\t\t\t\tthis.scrollAnimation = false;//关闭滑动动画\r\n\t\t\t\tlet Viewid = this.messageList[0].id;//记住第一个信息ID\r\n\t\t\t\t\tthis.$u.get(this.customerMsgRecordUrl,{\r\n\t\t\t\t\t\t'receiver':this.account,\r\n\t\t\t\t\t\t'pageNum':this.pageNum,\r\n\t\t\t\t\t\t'pageSize':this.pageSize\r\n\t\t\t\t\t}).then(res=>{\r\n\t\t\t\t\t\tthis.isHistoryLoading = false;\r\n\t\t\t\t\t\tvar newData=res.data.reverse();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// this.messageList=newData.concat(this.messageList);//数组翻转\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// 获取消息中的图片,并处理显示尺寸\r\n\t\t\t\t\t\tfor(let i=0;i<newData.length;i++){\r\n\t\t\t\t\t\t\tif(newData[i].mediaType==2 ){\r\n\t\t\t\t\t\t\t\tthis.msgImgList.push(newData[i].content);\r\n\t\t\t\t\t\t\t} \r\n\t\t\t\t\t\t\tthis.messageList.unshift(newData[i]);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tconsole.log(\"所有消息\");\r\n\t\t\t\t\t\tconsole.log(this.messageList);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t//这段代码很重要，不然每次加载历史数据都会跳到顶部\r\n\t\t\t\t\t\tthis.$nextTick(function() {\r\n\t\t\t\t\t\t\tthis.scrollToView ='msg'+ Viewid;//跳转上次的第一行信息位置\r\n\t\t\t\t\t\t\t// uni.pageScrollTo({         //回到下拉之前，多展示一条消息\r\n\t\t\t\t\t\t\t// \tscrollTop: 'msg'+ Viewid,\r\n\t\t\t\t\t\t\t// \tduration: 0\r\n\t\t\t\t\t\t\t// });\r\n\t\t\t\t\t\t\tthis.$nextTick(function() {\r\n\t\t\t\t\t\t\t\tthis.scrollAnimation = true;//恢复滚动动画\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}).catch(ex=>{\r\n\t\t\t\t\t\tif(ex.data.status==4){\r\n\t\t\t\t\t\t\tthis.$u.toast(\"已加载全部消息\");\r\n\t\t\t\t\t\t\tthis.isHistoryLoading = false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t//更多功能(点击+弹出) \r\n\t\t\tshowMore(){\r\n\t\t\t\tthis.isVoice = false;\r\n\t\t\t\tif(this.hideMore){\r\n\t\t\t\t\tthis.hideMore = false;\r\n\t\t\t\t\tthis.openDrawer();\r\n\t\t\t\t}else{\r\n\t\t\t\t\tthis.hideDrawer();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t// 打开抽屉\r\n\t\t\topenDrawer(){\r\n\t\t\t\tthis.popupLayerClass = 'showLayer';\r\n\t\t\t},\r\n\t\t\t// 隐藏抽屉\r\n\t\t\thideDrawer(){\r\n\t\t\t\tthis.popupLayerClass = '';\r\n\t\t\t\tsetTimeout(()=>{\r\n\t\t\t\t\tthis.hideMore = true;\r\n\t\t\t\t},150);\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t//选照片 or 拍照\r\n\t\t\tgetImage(){\r\n\t\t\t\t\tthis.hideDrawer();\r\n\t\t\t\t\tvar me=this;\r\n\t\t\t\t   uni.chooseImage({\r\n\t\t\t\t    count: 1, //默认9\r\n\t\t\t\t\tsizeType: ['compressed'],\r\n\t\t\t\t    success: function(res) {\r\n\t\t\t\t\t\t console.log(JSON.stringify(res.tempFilePaths));\r\n\t\t\t\t\t\t console.log(me.id);\r\n\t\t\t\t\t\t console.log(me.account);\r\n\t\t\t\t\t\tme.sendImg(res.tempFilePaths[0]);\r\n\t\t\t\t    }\r\n\t\t\t\t   });\r\n\t\t\t},\r\n\t\t\t//发送图片\r\n\t\t\tsendImg(path){\r\n\t\t\t\t//上传文件\r\n\t\t\t\t// uni.showLoading();\r\n\t\t\t\tuni.uploadFile({\r\n\t\t\t\t\turl: this.sendChatUrl, \r\n\t\t\t\t\tfilePath: path,\r\n\t\t\t\t\tname: 'file',\r\n\t\t\t\t\tformData: {\r\n\t\t\t\t\t\t'from': this.id,\r\n\t\t\t\t\t\t'toUser': this.account,\r\n\t\t\t\t\t\t'mediaType': 2\r\n\t\t\t\t },\r\n\t\t\t\t success: (uploadFileRes) => {\r\n\t\t\t\t\tconsole.log(\"成功\");\r\n\t\t\t\t\tconsole.log(uploadFileRes.data); \r\n\t\t\t\t\tthis.getNewData();\r\n\t\t\t\t }\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t//获取焦点,则关闭抽屉\r\n\t\t\ttextareaFocus(){\r\n\t\t\t\tthis.focus=true;\r\n\t\t\t\tif(this.popupLayerClass=='showLayer'){\r\n\t\t\t\t\tthis.hideDrawer();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t// 发送文字消息\r\n\t\t\tsendText(){\r\n\t\t\t\tif(!this.textMsg){\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tthis.sendMsg(this.textMsg,1);\r\n\t\t\t\tthis.textMsg = '';//清空输入框\r\n\t\t\t\t\r\n\t\t\t},\r\n\t\t\t// 发送消息 请求接口\r\n\t\t\tsendMsg(content,type){\r\n\t\t\t\t//1 文字消息 2 图片消息3 问诊单问题 4问诊单回复 5推荐商品 6语音消息 7视频消息\r\n\t\t\t\tconsole.log(\"要发送的信息\");\r\n\t\t\t\tconsole.log(content);\r\n\t\t\t\tconsole.log(type);\r\n\t\t\t\tconsole.log(this.id);\r\n\t\t\t\tconsole.log(this.account);\r\n\t\t\t\t// uni.showLoading();\r\n\t\t\t\tthis.$u.get(\"send/chat?\"+\r\n\t\t\t\t\t\"message=\"+content+\"&\"+\r\n\t\t\t\t\t\"mediaType=\"+type+\"&\"+\r\n\t\t\t\t\t\"from=\" +this.id+\"&\"+\r\n\t\t\t\t\t\"file=\"+content+\"&\"+\r\n\t\t\t\t\t\"toUser=\"+this.account\r\n\t\t\t\t).then(res=>{\r\n\t\t\t\t\tthis.getNewData();\r\n\t\t\t\t\tconsole.log(\"发送消息成功\");\r\n\t\t\t\t\tconsole.log(res);\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\t//发送消息之后网络获取最新一条数据拼接在整个消息数据的后面\r\n\t\t\tgetNewData(){\r\n\t\t\t\tconsole.log(\"开始获取第一条消息\");\r\n\t\t\t\tthis.$u.get(this.customerMsgRecordUrl,{\r\n\t\t\t\t\t'receiver':this.account,\r\n\t\t\t\t\t'pageNum':1,\r\n\t\t\t\t\t'pageSize':1\r\n\t\t\t\t}).then(res=>{\r\n\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t\tconst oneMessageData= res.data;\r\n\t\t\t\t\tconsole.log(\"最新获取到的消息\");\r\n\t\t\t\t\tconsole.log(oneMessageData);\r\n\t\t\t\t\t\r\n\t\t\t\t\tthis.messageList=this.messageList.concat(oneMessageData);//数据拼接\r\n\t\t\t\t\tconsole.log(\"滚动到最下面的id\");\r\n\t\t\t\t\tconsole.log(oneMessageData[0].id);\r\n\t\t\t\t\t//滚动到底部\r\n\t\t\t\t\tthis.$nextTick(function() {\r\n\t\t\t\t\t\t//进入页面滚动到底部\r\n\t\t\t\t\t\tthis.scrollToView = 'msg'+oneMessageData[0].id;\r\n\t\t\t\t\t\tthis.$nextTick(function() {\r\n\t\t\t\t\t\t\tthis.scrollAnimation = true;\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t// 获取消息中的图片,并处理显示尺寸\r\n\t\t\t\t\tif(oneMessageData[0].mediaType==2 ){\r\n\t\t\t\t\t\tthis.msgImgList.push(oneMessageData[0].content);\r\n\t\t\t\t\t} \r\n\t\t\t\t\t\t\r\n\t\t\t\t\t//非自己的消息震动\r\n\t\t\t\t\tif(oneMessageData[0].sendId==account){\r\n\t\t\t\t\t\tuni.vibrateLong();\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t// 预览图片 点击放大图\r\n\t\t\tshowPic(msg){\r\n\t\t\t\tuni.previewImage({\r\n\t\t\t\t\tindicator:\"none\",\r\n\t\t\t\t\tcurrent:msg,\r\n\t\t\t\t\turls: this.msgImgList\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t// 播放语音\r\n\t\t\tplayVoice(msg,id){\r\n\t\t\t\tthis.playMsgid=id;\r\n\t\t\t\tthis.AUDIO.src = msg;\r\n\t\t\t\tthis.$nextTick(function() {\r\n\t\t\t\t\tthis.AUDIO.play();\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t// 录音开始\r\n\t\t\tvoiceBegin(e){\r\n\t\t\t\tconsole.log(\"开始录制\");\r\n\t\t\t\tconsole.log(e);\r\n\t\t\t\tif(e.touches.length>1){\r\n\t\t\t\t\treturn ;\r\n\t\t\t\t}\r\n\t\t\t\tthis.initPoint.Y = e.touches[0].clientY;\r\n\t\t\t\tthis.initPoint.identifier = e.touches[0].identifier;\r\n\t\t\t\tthis.RECORDER.start({format:\"mp3\"});//录音开始,\r\n\t\t\t},\r\n\t\t\t//录音开始UI效果\r\n\t\t\trecordBegin(e){\r\n\t\t\t\tthis.recording = true;\r\n\t\t\t\tthis.voiceTis='松开 结束';\r\n\t\t\t\tthis.recordLength = 0;\r\n\t\t\t\tthis.recordTimer = setInterval(()=>{\r\n\t\t\t\t\tthis.recordLength++;\r\n\t\t\t\t},1000)\r\n\t\t\t},\r\n\t\t\t// 录音被打断\r\n\t\t\tvoiceCancel(){\r\n\t\t\t\tthis.recording = false;\r\n\t\t\t\tthis.voiceTis='按住 说话';\r\n\t\t\t\tthis.recordTis = '手指上滑 取消发送'\r\n\t\t\t\tthis.willStop = true;//不发送录音\r\n\t\t\t\tthis.RECORDER.stop();//录音结束\r\n\t\t\t},\r\n\t\t\t// 录音中(判断是否触发上滑取消发送)\r\n\t\t\tvoiceIng(e){\r\n\t\t\t\tif(!this.recording){\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tlet touche = e.touches[0];\r\n\t\t\t\t//上滑一个导航栏的高度触发上滑取消发送\r\n\t\t\t\tif(this.initPoint.Y - touche.clientY>=uni.upx2px(100)){\r\n\t\t\t\t\tthis.willStop = true;\r\n\t\t\t\t\tthis.recordTis = '松开手指 取消发送'\r\n\t\t\t\t}else{\r\n\t\t\t\t\tthis.willStop = false;\r\n\t\t\t\t\tthis.recordTis = '手指上滑 取消发送'\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t// 结束录音\r\n\t\t\tvoiceEnd(e){\r\n\t\t\t\tif(!this.recording){\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tthis.recording = false;\r\n\t\t\t\tthis.voiceTis='按住 说话';\r\n\t\t\t\tthis.recordTis = '手指上滑 取消发送'\r\n\t\t\t\tthis.RECORDER.stop();//录音结束\r\n\t\t\t},\r\n\t\t\t//录音结束(回调文件)\r\n\t\t\trecordEnd(e){\r\n\t\t\t\tvar me=this;\r\n\t\t\t\tclearInterval(this.recordTimer);\r\n\t\t\t\tif(!this.willStop){\r\n\t\t\t\t\tconsole.log(\"要上传的语音\");\r\n\t\t\t\t\tconsole.log(e.tempFilePath);\r\n\t\t\t\t\t\r\n\t\t\t\t\t// let min = parseInt(this.recordLength/60);\r\n\t\t\t\t\t// let sec = this.recordLength%60;\r\n\t\t\t\t\t// min = min<10?'0'+min:min;\r\n\t\t\t\t\t// sec = sec<10?'0'+sec:sec;\r\n\t\t\t\t\t// let time = min+':'+sec;\r\n\t\t\t\t\t\r\n\t\t\t\t\tconsole.log(\"要上传语音的时长\");\r\n\t\t\t\t\tconsole.log(this.recordLength);\r\n\t\t\t\t\tif(this.recordLength<1){\r\n\t\t\t\t\t\tthis.$u.toast(\"时间过短，请重新录制\");\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// uni.showLoading();\r\n\t\t\t\t\t//上传文件\r\n\t\t\t\t\tuni.uploadFile({\r\n\t\t\t\t\t    url:me.sendChatUrl,\r\n\t\t\t\t\t    method:\"POST\",\r\n\t\t\t\t\t    filePath:e.tempFilePath,\r\n\t\t\t\t\t    name:'file',\r\n\t\t\t\t\t\tformData: {\r\n\t\t\t\t\t\t\t'from': me.id,\r\n\t\t\t\t\t\t\t'toUser': me.account,\r\n\t\t\t\t\t\t\t'mediaType':6,\r\n\t\t\t\t\t\t\t'message':this.recordLength\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t    success: (res) => {                    \r\n\t\t\t\t\t        let videoUrls = res.data //百度支持\r\n\t\t\t\t\t        console.log(\"上传语音成功\" + videoUrls);\r\n\t\t\t\t\t\t\tme.getNewData();\r\n\t\t\t\t\t    }\r\n\t\t\t\t\t})\r\n\t\t\t\t}else{\r\n\t\t\t\t\tconsole.log('取消发送录音');\r\n\t\t\t\t}\r\n\t\t\t\tthis.willStop = false;\r\n\t\t\t},\r\n\t\t\t// 切换语音/文字输入\r\n\t\t\tswitchVoice(){\r\n\t\t\t\tthis.hideDrawer();\r\n\t\t\t\tthis.isVoice = this.isVoice?false:true;\r\n\t\t\t},\r\n\t\t\tdiscard(){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</script>\r\n<style lang=\"scss\">\r\n\t@import \"chat.scss\"; \r\n</style>\n","import mod from \"-!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--8-oneOf-1-0!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-1!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-2!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--8-oneOf-1-3!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\sass-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-4!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-5!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./chat.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--8-oneOf-1-0!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-1!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-2!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--8-oneOf-1-3!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\sass-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-4!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-5!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./chat.vue?vue&type=style&index=0&lang=scss&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1608888968048\n      var cssReload = require(\"D:/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}